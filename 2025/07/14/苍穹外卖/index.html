<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>苍穹外卖 | jfan-ai</title><meta name="author" content="jfan-ai"><meta name="copyright" content="jfan-ai"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="这是我的第一个java项目，加油！！！">
<meta property="og:type" content="article">
<meta property="og:title" content="苍穹外卖">
<meta property="og:url" content="https://jfan-ai.github.io/2025/07/14/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96/">
<meta property="og:site_name" content="jfan-ai">
<meta property="og:description" content="这是我的第一个java项目，加油！！！">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://jfan-ai.github.io/images/me.jpg">
<meta property="article:published_time" content="2025-07-14T03:04:58.481Z">
<meta property="article:modified_time" content="2025-07-19T10:06:56.195Z">
<meta property="article:author" content="jfan-ai">
<meta property="article:tag" content="java">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://jfan-ai.github.io/images/me.jpg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "苍穹外卖",
  "url": "https://jfan-ai.github.io/2025/07/14/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96/",
  "image": "https://jfan-ai.github.io/images/me.jpg",
  "datePublished": "2025-07-14T03:04:58.481Z",
  "dateModified": "2025-07-19T10:06:56.195Z",
  "author": [
    {
      "@type": "Person",
      "name": "jfan-ai",
      "url": "https://jfan-ai.github.io"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://jfan-ai.github.io/2025/07/14/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!true && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '苍穹外卖',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><style>
  /* ===== 去掉顶部深蓝色导航栏，和背景融为一体 ===== */
  #nav {
  background: transparent !important;
  box-shadow: none !important;
  }
  #nav,
  #navbar,
  .navbar,
  .nav-fixed,
  header#nav.nav-fixed {
  background: transparent !important;
  background-image: none !important;
  box-shadow: none !important;
  }
  /* ===== 白天模式（黑字） ===== */
  body:not([data-theme="dark"]) {
    background: url(/images/top.jpg) no-repeat center/cover fixed;
    color: #111 !important;
  }

  /* ===== 黑夜模式（白字 + 压暗背景） ===== */
  [data-theme="dark"] {
    background: linear-gradient(rgba(0,0,0,.6), rgba(0,0,0,.6)),
                url(/images/top.jpg) center/cover fixed;
    color: #fff !important;
  }

  /* 黑夜：所有文字统一变白 */
  [data-theme="dark"] body,
  [data-theme="dark"] #nav a,
  [data-theme="dark"] .post-meta,
  [data-theme="dark"] .post-meta time,
  [data-theme="dark"] .post-date,
  [data-theme="dark"] .article-title,
  [data-theme="dark"] .article-content,
  [data-theme="dark"] #aside-content,
  [data-theme="dark"] #footer-wrap,
  [data-theme="dark"] .recent-post-info,
  [data-theme="dark"] .archive-article-date,
  [data-theme="dark"] .card-widget {
    color: #ffffff !important;
    text-shadow: 0 0 2px rgba(0,0,0,.8);
  }

  /* 黑夜：卡片半透明黑 */
  [data-theme="dark"] #recent-posts > .recent-post-item,
  [data-theme="dark"] #aside-content .card-widget {
    background: rgba(0,0,0,.55) !important;
    backdrop-filter: blur(8px);
  }
  [data-theme="dark"] body {
    background: linear-gradient(rgba(0,0,0,.7), rgba(0,0,0,.7)),
                url(/images/top.jpg) no-repeat center/cover fixed !important;
  }
  /* 顶部导航透明通用 */
  #nav {
    background: transparent !important;
    box-shadow: none !important;
  }

  /* 页脚透明通用 */
  #footer {
    background: transparent !important;
    box-shadow: none;
  }
</style>
<meta name="generator" content="Hexo 7.3.0"></head><body><div id="web_bg" style="background: linear-gradient(135deg,;"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/images/me.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">12</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">6</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">4</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">jfan-ai</span></a><a class="nav-page-title" href="/"><span class="site-name">苍穹外卖</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  返回首页</span></span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">苍穹外卖</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-07-14T03:04:58.481Z" title="发表于 2025-07-14 11:04:58">2025-07-14</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-07-19T10:06:56.195Z" title="更新于 2025-07-19 18:06:56">2025-07-19</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%8A%80%E6%9C%AF/">技术</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">10.4k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>42分钟</span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><p><strong>这是我的第一个java项目，加油！！！</strong></p>
<span id="more"></span>

<h2 id="Day-1"><a href="#Day-1" class="headerlink" title="Day-1"></a>Day-1</h2><h3 id="开发环境搭建"><a href="#开发环境搭建" class="headerlink" title="开发环境搭建"></a>开发环境搭建</h3><p>苍穹外卖的前后端分离了吗？前端使用什么服务器，后端采用什么结构设计？</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">苍穹外卖确实采用了 前后端分离 的架构：</span><br><span class="line"></span><br><span class="line">前端服务器：使用 Nginx 部署静态资源，前端管理端基于 Vue.js + ElementUI 开发，用户端使用微信小程序 。</span><br><span class="line">后端结构：基于 Spring Boot 构建，采用 分层架构，包括：</span><br><span class="line">网关层：由 Nginx 提供反向代理和负载均衡；</span><br><span class="line">应用层：使用 Spring Boot + Spring MVC + Spring Task + JWT + Swagger 等；</span><br><span class="line">数据层：MySQL 存储核心业务数据，Redis 做缓存，MyBatis 作为 ORM 框架 。</span><br><span class="line"></span><br><span class="line">后端工程最终打包为 jar 包（Spring Boot 内嵌 Tomcat 启动），前端静态资源部署在 Nginx 中 </span><br></pre></td></tr></table></figure>

<p>Maven父工程和聚合工程的打包方式是什么？ 父工程主要由什么组成？每个模块含有什么内容？</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">一、父工程和聚合工程的打包方式</span><br><span class="line">父工程（Parent POM）</span><br><span class="line">打包方式：&lt;packaging&gt;pom&lt;/packaging&gt;</span><br><span class="line">只做依赖管理和版本控制，不生成可执行文件（如 jar/war）。</span><br><span class="line">聚合工程（Aggregator）</span><br><span class="line">打包方式：&lt;packaging&gt;pom&lt;/packaging&gt;</span><br><span class="line">通过 &lt;modules&gt; 聚合子模块（如 common、pojo、server），统一执行构建命令（如 mvn clean package）。</span><br><span class="line"></span><br><span class="line">二、父工程组成</span><br><span class="line">父工程 sky-take-out 的核心作用：</span><br><span class="line">依赖版本管理（&lt;dependencyManagement&gt;）：</span><br><span class="line">统一 SpringBoot、MyBatis、MySQL、JWT 等依赖的版本，避免子模块版本冲突。</span><br><span class="line">插件管理（&lt;pluginManagement&gt;）：</span><br><span class="line">如 SpringBoot Maven 插件、Lombok 插件等。</span><br><span class="line">公共配置：</span><br><span class="line">如 Maven 仓库地址、编码格式（UTF-8）、Java 版本（JDK 1.8）。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">三、子模块内容与作用</span><br><span class="line">模块名	打包方式	内容说明</span><br><span class="line">sky-common	jar	公共工具类（如 JwtUtils、BaseContext）、常量类（如 StatusConstant）、异常处理类等。</span><br><span class="line">sky-pojo	jar	实体类（如 Employee、Order）、DTO（如 EmployeeLoginDTO）、VO（如 OrderStatisticsVO）。</span><br><span class="line">sky-server	jar	核心业务代码：Controller、Service、Mapper、配置文件（application.yml）、启动类（SkyApplication.java）。</span><br></pre></td></tr></table></figure>

<h3 id="git版本控制"><a href="#git版本控制" class="headerlink" title="git版本控制"></a>git版本控制</h3><p>为什么要创建git仓库？ </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">版本控制：像“时光机”一样，随时回退到任意历史版本。</span><br><span class="line">多人协作：团队成员可并行开发，避免文件冲突。</span><br><span class="line">备份：代码托管到 GitHub/GitLab，防止本地磁盘损坏导致代码丢失。</span><br><span class="line">持续集成：配合 GitHub Actions、Jenkins 实现自动测试、打包、部署。</span><br></pre></td></tr></table></figure>

<p>每完成一个接口，要提交git吗？要写message信息吗？ 为什么要写？ </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">要不要提交？</span><br><span class="line">✅ 建议提交——每个完整功能（如“新增菜品分页接口”）作为一次提交，粒度适中，方便回滚。</span><br><span class="line">要不要写 message？</span><br><span class="line">✅ 必须写！message 是“代码日记”，让队友（或未来的你）一眼看懂这次提交做了什么。</span><br><span class="line">为什么写？</span><br><span class="line">快速定位问题（如“哪次提交导致支付失败”）。</span><br><span class="line">生成 ChangeLog（Release 时自动汇总更新内容）。</span><br><span class="line">代码评审（PR）时，reviewer 通过 message 了解上下文。</span><br></pre></td></tr></table></figure>

<p>项目总的文件，所有都要提交吗？</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">❌ 不是全部！</span><br><span class="line">要提交：</span><br><span class="line">源码（src/）、配置文件（application.yml）、静态资源（static/）。</span><br><span class="line">不要提交：</span><br><span class="line">敏感信息（数据库密码、私钥）。</span><br><span class="line">构建产物（target/、*.jar、*.war）。</span><br><span class="line">IDE 配置（.idea/、.vscode/）。</span><br><span class="line">依赖库（node_modules/、maven 的本地仓库）。</span><br><span class="line">怎么忽略？</span><br><span class="line">用 .gitignore 文件声明（如 Java 项目模板见 gitignore.io）。</span><br></pre></td></tr></table></figure>

<h3 id="数据库搭建"><a href="#数据库搭建" class="headerlink" title="数据库搭建"></a>数据库搭建</h3><h3 id="管理员登录功能"><a href="#管理员登录功能" class="headerlink" title="管理员登录功能"></a>管理员登录功能</h3><p>避坑！！！！！！</p>
<p><img src="/../images/image-20250718103138170.png" alt="image-20250718103138170"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">EmployeeController:</span><br><span class="line">	1.根据employeeDTO通过数据库查询拿到employee的信息</span><br><span class="line">	2.登录成功后，生成jwt令牌    需要用到的claims包含empid:id</span><br><span class="line">	3.利用JwtUtil工具类生成jwt令牌</span><br><span class="line">	4.构造EmployeeLoginVO对象返回</span><br><span class="line">EmployeeService:</span><br><span class="line">	1.拿到username and password</span><br><span class="line">	2.根据username查询数据库返回employee对象</span><br><span class="line">	3.如果employee为null 抛出自定义异常</span><br><span class="line">	4.password md5加密 密码对比 如果不正确 抛出自定义异常</span><br><span class="line">	5.查看账户是否被锁定即status是否为0 锁定抛出自定义异常</span><br><span class="line">	6.以上都正确 返回employee</span><br><span class="line">EmployeeMapper:</span><br><span class="line">	1.根据username查询返回employee对象</span><br></pre></td></tr></table></figure>

<p>后续登录，前端会携带JWT令牌，通过JWT令牌可以解析出当前员工id</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">JwtTokenAdminInterceptor.java</span><br><span class="line">	<span class="comment">//1、从请求头中获取令牌</span></span><br><span class="line">     <span class="comment">//2、校验令牌</span></span><br><span class="line">    <span class="comment">//3、通过，放行</span></span><br><span class="line">     <span class="comment">//4、不通过，响应401状态码</span></span><br></pre></td></tr></table></figure>



<p>前后端联调这项工作时什么时候进行的？</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">接口 ready、页面 ready → 立即联调；上线前必须再统一跑一次全链路。</span><br></pre></td></tr></table></figure>

<p>前后端联调工作的主要内容是什么？或者说为什么要进行前后端联调 ?</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">把各自跑得好好的代码，放到一起跑一次全链路验收”，确保用户真正用起来不会崩、不会错、不会慢。</span><br></pre></td></tr></table></figure>

<h3 id="nginx反向代理和负载均衡"><a href="#nginx反向代理和负载均衡" class="headerlink" title="nginx反向代理和负载均衡"></a>nginx反向代理和负载均衡</h3><p>为什么不直接通过浏览器直接请求后台服务端，需要通过Nginx反向代理呢？</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">nginx 反向代理可以提高访问速度、进行负载均衡、保证后端服务安全</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">提高访问速度</span><br><span class="line"></span><br><span class="line">因为nginx本身可以进行缓存，如果访问的同一接口，并且做了数据缓存，nginx就直接可把数据返回，不需要真正地访问服务端，从而提高访问速度。</span><br><span class="line"></span><br><span class="line">进行负载均衡</span><br><span class="line"></span><br><span class="line">所谓负载均衡,就是把大量的请求按照我们指定的方式均衡的分配给集群中的每台服务器。</span><br><span class="line"></span><br><span class="line">保证后端服务安全</span><br><span class="line"></span><br><span class="line">因为一般后台服务地址不会暴露，所以使用浏览器不能直接访问，可以把nginx作为请求访问的入口，请求到达nginx后转发到具体的服务中，从而保证后端服务的安全。</span><br></pre></td></tr></table></figure>

<p>反向代理的配置方式</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">server&#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    server_name localhost;</span><br><span class="line">    </span><br><span class="line">    location /api/&#123;</span><br><span class="line">        proxy_pass http://localhost:8080/admin/; #反向代理</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">proxy_pass： 该指令是用来设置代理服务器的地址，可以是主机名称，IP地址加端口号等形式。</span><br><span class="line"></span><br><span class="line">如上代码的含义是：监听80端口号， 然后当我们访问 http://localhost:80/api/../..这样的接口的时候，它会通过 location /api/ &#123;&#125; 这样的反向代理到 http://localhost:8080/admin/上来。</span><br><span class="line">当在访问http://localhost/api/employee/login，nginx接收到请求后转到http://localhost:8080/admin/，故最终的请求地址为http://localhost:8080/admin/employee/login，和后台服务的访问地址一致。</span><br></pre></td></tr></table></figure>

<p>nginx 负载均衡默认是什么策略？</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">轮询（Round Robin）</span><br><span class="line">即：把请求 按顺序轮流 分发给后端服务器，不附加任何权重或状态判断。</span><br></pre></td></tr></table></figure>

<h3 id="Swagger"><a href="#Swagger" class="headerlink" title="Swagger"></a>Swagger</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">1.导入 knife4j 的maven坐标</span><br><span class="line">2.在配置类中加入 knife4j 相关配置</span><br><span class="line">	WebMvcConfiguration.java</span><br><span class="line">	@Bean</span><br><span class="line">    public Docket docket() &#123;</span><br><span class="line">        ApiInfo apiInfo = new ApiInfoBuilder()</span><br><span class="line">                .title(&quot;苍穹外卖项目接口文档&quot;)</span><br><span class="line">                .version(&quot;2.0&quot;)</span><br><span class="line">                .description(&quot;苍穹外卖项目接口文档&quot;)</span><br><span class="line">                .build();</span><br><span class="line">        Docket docket = new Docket(DocumentationType.SWAGGER_2)</span><br><span class="line">                .apiInfo(apiInfo)</span><br><span class="line">                .select()</span><br><span class="line">                .apis(RequestHandlerSelectors.basePackage(&quot;com.sky.controller&quot;))</span><br><span class="line">                .paths(PathSelectors.any())</span><br><span class="line">                .build();</span><br><span class="line">        return docket;</span><br><span class="line">    &#125;</span><br><span class="line"> 3.设置静态资源映射，否则接口文档页面无法访问</span><br><span class="line"> 	protected void addResourceHandlers(ResourceHandlerRegistry registry) &#123;</span><br><span class="line">        registry.addResourceHandler(&quot;/doc.html&quot;).addResourceLocations(&quot;classpath:/META-INF/resources/&quot;);</span><br><span class="line">        registry.addResourceHandler(&quot;/webjars/**&quot;).addResourceLocations(&quot;classpath:/META-INF/resources/webjars/&quot;);</span><br><span class="line">     &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">pojo</span><br><span class="line">	@ApiModel(description = &quot; &quot;)</span><br><span class="line">	@ApiModelProperty(&quot; &quot;)</span><br><span class="line">controller</span><br><span class="line">	@Api(tags = &quot; &quot;)</span><br><span class="line">	@ApiOperation(value = &quot; &quot;)</span><br></pre></td></tr></table></figure>



<h2 id="Day-2"><a href="#Day-2" class="headerlink" title="Day-2"></a>Day-2</h2><h3 id="新增员工功能"><a href="#新增员工功能" class="headerlink" title="新增员工功能"></a>新增员工功能</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">service:</span><br><span class="line">	<span class="number">1.</span>创建一个employee实体 用来拷贝数据</span><br><span class="line">	<span class="number">2.</span>补充dto没有的属性 状态 密码 创建时间 修改时间 创建人id 更改人id</span><br><span class="line">	<span class="number">3.</span>调用mapper插入</span><br><span class="line">mapper:</span><br><span class="line">	<span class="keyword">insert into</span> employee (username, name, password, phone, sex, id_number, status, create_time, update_time, create_user, update_user) &quot; +</span><br><span class="line">            &quot;<span class="keyword">values</span> &quot; +</span><br><span class="line">            &quot;(#&#123;username&#125;, #&#123;name&#125;, #&#123;password&#125;, #&#123;phone&#125;, #&#123;sex&#125;, #&#123;idNumber&#125;, #&#123;status&#125;, #&#123;createTime&#125;, #&#123;updateTime&#125;, #&#123;createUser&#125;, #&#123;updateUser&#125;)&quot;)</span><br></pre></td></tr></table></figure>

<p>在application.yml中已开启驼峰命名，故id_number和idNumber可对应。</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">mybatis:</span></span><br><span class="line">  <span class="attr">configuration:</span></span><br><span class="line">    <span class="comment">#开启驼峰命名</span></span><br><span class="line">    <span class="attr">map-underscore-to-camel-case:</span> <span class="literal">true</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>DTO实体类数据怎么传递到Entity实体类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>手动转换</span><br><span class="line"><span class="comment">// UserDTO -&gt; UserEntity</span></span><br><span class="line"><span class="type">UserEntity</span> <span class="variable">userEntity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserEntity</span>();</span><br><span class="line">userEntity.setUsername(userDTO.getUsername());</span><br><span class="line">userEntity.setEmail(userDTO.getEmail());</span><br><span class="line"><span class="comment">// 设置其他字段...</span></span><br><span class="line"></span><br><span class="line"><span class="number">2.</span>使用工具类</span><br><span class="line"><span class="comment">// 使用Spring的BeanUtils</span></span><br><span class="line"><span class="type">UserEntity</span> <span class="variable">userEntity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserEntity</span>();</span><br><span class="line">BeanUtils.copyProperties(userDTO, userEntity);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 或使用MapStruct</span></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line">    UserEntity <span class="title function_">dtoToEntity</span><span class="params">(UserDTO dto)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="number">3.</span> 使用Builder模式</span><br><span class="line"> 	<span class="type">UserEntity</span> <span class="variable">userEntity</span> <span class="operator">=</span> UserEntity.builder()</span><br><span class="line">    .username(userDTO.getUsername())</span><br><span class="line">    .email(userDTO.getEmail())</span><br><span class="line">    .build();</span><br></pre></td></tr></table></figure>

<p>前端传递的实体类数据，还需要补充什么信息才能存到数据库表中？</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>主键ID：通常由数据库自动生成（如自增ID或UUID）</span><br><span class="line"><span class="number">2.</span>审计字段：</span><br><span class="line">创建时间</span><br><span class="line">更新时间</span><br><span class="line">创建人</span><br><span class="line">更新人</span><br><span class="line"><span class="number">3.</span>业务状态字段：</span><br><span class="line">状态枚举</span><br><span class="line">审核状态等</span><br><span class="line"><span class="number">4.</span>关联关系：</span><br><span class="line">外键关联的其他实体ID</span><br><span class="line">一对多、多对多关系的集合</span><br></pre></td></tr></table></figure>

<p>用户名存在问题</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">java.sql.SQLIntegrityConstraintViolationException: Duplicate entry <span class="string">&#x27;zfl&#x27;</span> <span class="keyword">for</span> key <span class="string">&#x27;employee.idx_username&#x27;</span></span><br><span class="line">发现，username已经添加了唯一约束，不能重复。</span><br><span class="line">通过全局异常处理器来处理。</span><br><span class="line">进入到sky-server模块，com.sky.handler包下，GlobalExceptionHandler.java添加方法</span><br><span class="line">	<span class="number">1.</span><span class="comment">//获取异常的具体信息</span></span><br><span class="line">    <span class="number">2.</span><span class="comment">//判断是否包含”Duplicate entry”</span></span><br><span class="line">    <span class="number">3.</span><span class="comment">//将信息分割成数组</span></span><br><span class="line">    <span class="number">4.</span><span class="comment">//获得第三个字段即用户名信息</span></span><br><span class="line">    <span class="number">5.</span><span class="comment">//构造具体的提示信息，如：zfl + “已存在”</span></span><br><span class="line">    <span class="number">6.</span><span class="comment">//返回带有具体提示信息的错误结果</span></span><br><span class="line">    <span class="number">7.</span><span class="comment">//如果不是重复条目异常，则返回通用的未知错误提示</span></span><br><span class="line">进入到sky-common模块，在MessageConstant.java添加</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">ALREADY_EXISTS</span> <span class="operator">=</span> <span class="string">&quot;已存在&quot;</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>创建id固定问题</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">利用BaseContext工具类操作ThreadLocal</span><br></pre></td></tr></table></figure>

<h3 id="员工分页查询"><a href="#员工分页查询" class="headerlink" title="员工分页查询"></a>员工分页查询</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">设计DTO类</span><br><span class="line">    包含name page pageSize</span><br><span class="line">封装pageResult</span><br><span class="line">    <span class="keyword">private</span> <span class="type">long</span>  total<span class="comment">//总记录数</span></span><br><span class="line">    <span class="keyword">private</span> List records<span class="comment">//当前页数据集合</span></span><br><span class="line">controller</span><br><span class="line">    返回的是PageResult</span><br><span class="line">service</span><br><span class="line">    使用pageHelper分页插件 设置当前页码和每页显示条数</span><br><span class="line">    调用mapper分页查询 返回Page&lt;Employee&gt;对象</span><br><span class="line">    获取page的结果</span><br><span class="line">mapper</span><br><span class="line">    select * from employee</span><br><span class="line">    &lt;where&gt;</span><br><span class="line">        &lt;<span class="keyword">if</span> test=<span class="string">&quot;name != null and name != &#x27;&#x27;&quot;</span>&gt;</span><br><span class="line">            and name like <span class="title function_">concat</span><span class="params">(<span class="string">&#x27;%&#x27;</span>,#&#123;name&#125;,<span class="string">&#x27;%&#x27;</span>)</span></span><br><span class="line">        &lt;/<span class="keyword">if</span>&gt;</span><br><span class="line">    &lt;/where&gt;</span><br><span class="line">    order by create_time desc</span><br></pre></td></tr></table></figure>

<p>分页查询中前端应该传递什么参数给后端，后端应该返回什么数据给前端？</p>
<table>
<thead>
<tr>
<th>参数名</th>
<th>类型</th>
<th>是否必填</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>page</code></td>
<td>int</td>
<td>是</td>
<td>当前页码（从1开始，避免从0开始导致用户困惑）。</td>
</tr>
<tr>
<td><code>size</code>&#x2F;<code>limit</code></td>
<td>int</td>
<td>是</td>
<td>每页条数（需限制最大值，如<code>size &lt;= 100</code>，防止恶意请求）。</td>
</tr>
<tr>
<td><code>sort</code></td>
<td>string</td>
<td>否</td>
<td>排序字段（如<code>sort=createTime</code>）。</td>
</tr>
<tr>
<td><code>order</code></td>
<td>string</td>
<td>否</td>
<td>排序方式（如<code>order=desc</code>或<code>asc</code>，需后端校验合法性）。</td>
</tr>
<tr>
<td>其他过滤条件</td>
<td>-</td>
<td>否</td>
<td>根据业务需求传递（如<code>status=active</code>、<code>keyword=搜索词</code>等）。</td>
</tr>
</tbody></table>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;code&quot;</span>: <span class="number">200</span>,</span><br><span class="line">  <span class="string">&quot;message&quot;</span>: <span class="string">&quot;success&quot;</span>,</span><br><span class="line">  <span class="string">&quot;data&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;list&quot;</span>: [ <span class="comment">/* 当前页的数据数组 */</span> ],</span><br><span class="line">    <span class="string">&quot;total&quot;</span>: <span class="number">95</span>,          <span class="comment">// 总记录数（用于前端计算总页数）</span></span><br><span class="line">    <span class="string">&quot;page&quot;</span>: <span class="number">2</span>,            <span class="comment">// 当前页码</span></span><br><span class="line">    <span class="string">&quot;size&quot;</span>: <span class="number">10</span>,           <span class="comment">// 每页条数</span></span><br><span class="line">    <span class="string">&quot;pages&quot;</span>: <span class="number">10</span>           <span class="comment">// 总页数（后端计算后返回，避免前端重复计算）</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>操作时间字段显示有问题 完善</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">a.在属性上加上注解，对日期进行格式化</span><br><span class="line"><span class="meta">@JsonFormat(pattern = &quot;yyyy-MM-dd HH:mm:ss&quot;)</span></span><br><span class="line">b.在WebMvcConfiguration中扩展SpringMVC的消息转换器，统一对日期类型进行格式处理</span><br><span class="line">    <span class="comment">//创建消息转换器对象 MappingJackson2HttpMessageConverter</span></span><br><span class="line">    <span class="comment">//设置对象转换器，底层使用Jackson将Java对象转为json       setObjectMapper(new JacksonObjectMapper)</span></span><br><span class="line">    <span class="comment">//将消息转换器对象追加到converters中   converters.add(0,converter);</span></span><br></pre></td></tr></table></figure>

<p><strong>Spring MVC 的消息转换器（HttpMessageConverter）的作用是什么？</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">把 HTTP 请求体 ↔ Java 对象，以及 Java 对象 ↔ HTTP 响应体 做自动转换。</span><br></pre></td></tr></table></figure>

<h3 id="启用禁用账号功能"><a href="#启用禁用账号功能" class="headerlink" title="启用禁用账号功能"></a>启用禁用账号功能</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">controller:  public <span class="keyword">Result</span> startOrStop(<span class="variable">@PathVariable</span> <span class="type">Integer</span> status,Long id)&#123;&#125;</span><br><span class="line"></span><br><span class="line">mapper:  <span class="keyword">update</span> employee</span><br><span class="line">        <span class="operator">&lt;</span><span class="keyword">set</span><span class="operator">&gt;</span></span><br><span class="line">            <span class="operator">&lt;</span>if test<span class="operator">=</span>&quot;name != null&quot;<span class="operator">&gt;</span>name <span class="operator">=</span> #&#123;name&#125;,<span class="operator">&lt;</span><span class="operator">/</span>if<span class="operator">&gt;</span></span><br><span class="line">            <span class="operator">&lt;</span>if test<span class="operator">=</span>&quot;username != null&quot;<span class="operator">&gt;</span>username <span class="operator">=</span> #&#123;username&#125;,<span class="operator">&lt;</span><span class="operator">/</span>if<span class="operator">&gt;</span></span><br><span class="line">            <span class="operator">&lt;</span>if test<span class="operator">=</span>&quot;password != null&quot;<span class="operator">&gt;</span>password <span class="operator">=</span> #&#123;password&#125;,<span class="operator">&lt;</span><span class="operator">/</span>if<span class="operator">&gt;</span></span><br><span class="line">            <span class="operator">&lt;</span>if test<span class="operator">=</span>&quot;phone != null&quot;<span class="operator">&gt;</span>phone <span class="operator">=</span> #&#123;phone&#125;,<span class="operator">&lt;</span><span class="operator">/</span>if<span class="operator">&gt;</span></span><br><span class="line">            <span class="operator">&lt;</span>if test<span class="operator">=</span>&quot;sex != null&quot;<span class="operator">&gt;</span>sex <span class="operator">=</span> #&#123;sex&#125;,<span class="operator">&lt;</span><span class="operator">/</span>if<span class="operator">&gt;</span></span><br><span class="line">            <span class="operator">&lt;</span>if test<span class="operator">=</span>&quot;idNumber != null&quot;<span class="operator">&gt;</span>id_Number <span class="operator">=</span> #&#123;idNumber&#125;,<span class="operator">&lt;</span><span class="operator">/</span>if<span class="operator">&gt;</span></span><br><span class="line">            <span class="operator">&lt;</span>if test<span class="operator">=</span>&quot;updateTime != null&quot;<span class="operator">&gt;</span>update_Time <span class="operator">=</span> #&#123;updateTime&#125;,<span class="operator">&lt;</span><span class="operator">/</span>if<span class="operator">&gt;</span></span><br><span class="line">            <span class="operator">&lt;</span>if test<span class="operator">=</span>&quot;updateUser != null&quot;<span class="operator">&gt;</span>update_User <span class="operator">=</span> #&#123;updateUser&#125;,<span class="operator">&lt;</span><span class="operator">/</span>if<span class="operator">&gt;</span></span><br><span class="line">            <span class="operator">&lt;</span>if test<span class="operator">=</span>&quot;status != null&quot;<span class="operator">&gt;</span>status <span class="operator">=</span> #&#123;status&#125;,<span class="operator">&lt;</span><span class="operator">/</span>if<span class="operator">&gt;</span></span><br><span class="line">        <span class="operator">&lt;</span><span class="operator">/</span><span class="keyword">set</span><span class="operator">&gt;</span></span><br><span class="line">        <span class="keyword">where</span> id <span class="operator">=</span> #&#123;id&#125;           <span class="operator">/</span><span class="operator">/</span><span class="operator">&lt;</span><span class="keyword">set</span><span class="operator">&gt;</span>自动可以去掉,</span><br></pre></td></tr></table></figure>

<h3 id="编辑员工信息and根据id查询员工信息"><a href="#编辑员工信息and根据id查询员工信息" class="headerlink" title="编辑员工信息and根据id查询员工信息"></a>编辑员工信息and根据id查询员工信息</h3><h3 id="员工修改密码功能"><a href="#员工修改密码功能" class="headerlink" title="员工修改密码功能"></a>员工修改密码功能</h3><h3 id="导入分类模块功能代码"><a href="#导入分类模块功能代码" class="headerlink" title="导入分类模块功能代码"></a>导入分类模块功能代码</h3><h2 id="Day-3"><a href="#Day-3" class="headerlink" title="Day-3"></a>Day-3</h2><h3 id="公共字段自动填充"><a href="#公共字段自动填充" class="headerlink" title="公共字段自动填充"></a>公共字段自动填充</h3><p>统一处理方式</p>
<p>使用AOP切面编程，实现功能增强，来完成公共字段自动填充功能</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">自定义注解 AutoFill，用于标识需要进行公共字段自动填充的方法</span><br><span class="line">自定义切面类 AutoFillAspect，统一拦截加入了 AutoFill注解的方法，通过反射为公共字段赋值</span><br><span class="line">在 Mapper的方法 上加入 AutoFill 注解,并注释业务层赋值时间和用户Id的代码</span><br><span class="line"></span><br><span class="line">AutoFill: </span><br><span class="line">	<span class="meta">@Target(ElementType.METHOD)</span>  <span class="comment">//用于标注方法</span></span><br><span class="line">	<span class="meta">@Retention(RetentionPolicy.RUNTIME)</span> <span class="comment">//运行时保留</span></span><br><span class="line">	<span class="keyword">public</span> <span class="meta">@interface</span>  AutoFill &#123;</span><br><span class="line">    OperationType <span class="title function_">value</span><span class="params">()</span>; <span class="comment">//包含一个参数 value()，类型为 OperationType，用于指定操作类型。</span></span><br><span class="line">	&#125;</span><br><span class="line">AutoFillAspect:</span><br><span class="line">	<span class="meta">@Pointcut</span>：定义一个切面的切入点表达式，表示切面关注的连接点。</span><br><span class="line">    <span class="string">&quot;execution(* com.sky.mapper.*.*(..))&quot;</span>：匹配 com.sky.mapper 包中所有类的所有方法。</span><br><span class="line">    <span class="string">&quot;@annotation(com.sky.annotation.AutoFill)&quot;</span>：要求被拦截的方法上必须有 <span class="meta">@AutoFill</span> 注解。</span><br><span class="line">    autoFillPointCut()：是一个命名切入点的方法，后续可以在 <span class="meta">@Before</span>、<span class="meta">@Around</span> 等通知中引用该方法名，作为切入点。</span><br><span class="line">        </span><br><span class="line">    <span class="meta">@Before(&quot;autoFillPointCut()&quot;)</span>    </span><br><span class="line">    joinPoint.getSignature()：获取被拦截方法的签名。</span><br><span class="line">    (MethodSignature)：强制转换为 MethodSignature 类型，以便获取具体方法对象。</span><br><span class="line">    methodSignature.getMethod()：获得被拦截的 Method 对象。</span><br><span class="line">    getAnnotation(AutoFill.class)：检查该方法是否标注了 <span class="meta">@AutoFill</span> 注解。</span><br><span class="line">    autoFill.value()：获取注解中指定的操作类型（OperationType），用于后续自动填充逻辑判断 <span class="comment">//上述操作就是为了这个</span></span><br><span class="line">        </span><br><span class="line">    获取到当前被拦截的方法的参数--实体对象 joinPoint.getArgs();	</span><br><span class="line">    准备赋值的数据</span><br><span class="line">        </span><br><span class="line">   <span class="comment">//根据当前不同的操作类型，为对应的属性通过反射赋值</span></span><br><span class="line">    object.getClass()：获取当前实体对象的 Class 类型；</span><br><span class="line">    .getDeclaredMethod(...)：查找该类中声明的、名为 AutoFillConstant.SET_CREATE_TIME 的方法（如 <span class="string">&quot;setCreateTime&quot;</span>）；</span><br><span class="line">    LocalDateTime.class：指定要查找的方法参数类型为 LocalDateTime；</span><br><span class="line">    Method setCreateTime：得到一个 Method 对象，后续可以通过 invoke() 调用该 setter 方法进行字段赋值。 <span class="comment">//上述操作就是为了这个</span></span><br></pre></td></tr></table></figure>

<h3 id="文件上传实现"><a href="#文件上传实现" class="headerlink" title="文件上传实现"></a>文件上传实现</h3><p>实现步骤：</p>
<ol>
<li><p>定义OSS相关配置</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">application-dev.yml</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="attr">sky:</span></span><br><span class="line">  <span class="attr">alioss:</span></span><br><span class="line">    <span class="attr">endpoint:</span> <span class="string">oss-cn-hangzhou.aliyuncs.com</span></span><br><span class="line">    <span class="attr">access-key-id:</span> <span class="string">环境变量</span></span><br><span class="line">    <span class="attr">access-key-secret:</span> <span class="string">环境变量</span></span><br><span class="line">    <span class="attr">bucket-name:</span> <span class="string">sky-take-out</span></span><br><span class="line"><span class="string">application.yml</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">dev</span>    <span class="comment">#设置环境</span></span><br><span class="line"><span class="attr">sky:</span></span><br><span class="line">  <span class="attr">alioss:</span></span><br><span class="line">    <span class="attr">endpoint:</span> <span class="string">$&#123;sky.alioss.endpoint&#125;</span></span><br><span class="line">    <span class="attr">access-key-id:</span> <span class="string">$&#123;sky.alioss.access-key-id&#125;</span></span><br><span class="line">    <span class="attr">access-key-secret:</span> <span class="string">$&#123;sky.alioss.access-key-secret&#125;</span></span><br><span class="line">    <span class="attr">bucket-name:</span> <span class="string">$&#123;sky.alioss.bucket-name&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>


</li>
<li><p>读取OSS配置</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">在sky-common模块中，已定义</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.sky.properties;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;sky.alioss&quot;)</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AliOssProperties</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> String endpoint;</span><br><span class="line"><span class="keyword">private</span> String accessKeyId;</span><br><span class="line"><span class="keyword">private</span> String accessKeySecret;</span><br><span class="line"><span class="keyword">private</span> String bucketName;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


</li>
<li><p>生成OSS工具类对象</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">利用已有的ossutill工具类 生成对象</span><br></pre></td></tr></table></figure>


</li>
<li><p>定义文件上传接口</p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取文件原始名称: file.getOriginalFilename();</span></span><br><span class="line"><span class="comment"> * 截取原始文件名后缀名 : String extension = originalFilename.substring(originalFilename.lastIndexOf(&quot;.&quot;));</span></span><br><span class="line"><span class="comment"> * 构造新文件名称：随机数 + 文件后缀名 : UUID.randomUUID().toString()+extention;</span></span><br><span class="line"><span class="comment"> * 构造文件请求路径并返回:  String upload = aliOssUtil.upload(file.getBytes(), name);</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure>

<h3 id="新增菜品"><a href="#新增菜品" class="headerlink" title="新增菜品"></a>新增菜品</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">service:</span><br><span class="line">	由DTO得到dish 调用mapper</span><br><span class="line">	由DTO得到flavors 并赋值dishId</span><br><span class="line">	List<span class="tag">&lt;<span class="name">DishFlavor</span>&gt;</span> flavors = dishDTO.getFlavors();</span><br><span class="line">        if(flavors != null &amp;&amp; flavors.size() &gt; 0)&#123;</span><br><span class="line">            flavors.forEach(dishFlavor -&gt; &#123;</span><br><span class="line">                dishFlavor.setDishId(dishId);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">mapper:</span><br><span class="line">	<span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insert&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.sky.entity.Dish&quot;</span> <span class="attr">useGeneratedKeys</span>=<span class="string">&quot;true&quot;</span> <span class="attr">keyProperty</span>=<span class="string">&quot;id&quot;</span>&gt;</span> 后两个注意 生成id赋值给原来的dish</span><br><span class="line">	</span><br><span class="line">	    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertBatch&quot;</span> &gt;</span></span><br><span class="line">        insert into dish_flavor (dish_id,name, value) values</span><br><span class="line">                                                          <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;flavors&quot;</span> <span class="attr">item</span>=<span class="string">&quot;df&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span>&gt;</span></span><br><span class="line">                                                              (#&#123;df.dishId&#125;,#&#123;df.name&#125;,#&#123;df.value&#125;)</span><br><span class="line">                                                          <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="菜品分页查询"><a href="#菜品分页查询" class="headerlink" title="菜品分页查询"></a>菜品分页查询</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">controller: 返回Result&lt;PageResult&gt;</span><br><span class="line">service: PageHelper.startPage(...)</span><br><span class="line">     Page&lt;Dish&gt; page = dishMapper.pageQuery(dishPageQueryDTO);</span><br><span class="line">	返回的是<span class="keyword">new</span> <span class="title class_">PageResult</span>(page.getTotal(),page,getResult())</span><br><span class="line">mapper:</span><br><span class="line">	 select * from dish</span><br><span class="line">        &lt;where&gt;</span><br><span class="line">            &lt;<span class="keyword">if</span> test=<span class="string">&quot;name != null and name != &#x27;&#x27;&quot;</span>&gt;</span><br><span class="line">                and name like <span class="string">&#x27;%$&#123;name&#125;%&#x27;</span></span><br><span class="line">            &lt;/<span class="keyword">if</span>&gt;</span><br><span class="line">            &lt;<span class="keyword">if</span> test=<span class="string">&quot;categoryId != null&quot;</span>&gt;</span><br><span class="line">                <span class="type">and</span> <span class="variable">category_id</span> <span class="operator">=</span> #&#123;categoryId&#125;</span><br><span class="line">            &lt;/<span class="keyword">if</span>&gt;</span><br><span class="line">            &lt;<span class="keyword">if</span> test=<span class="string">&quot;status != null&quot;</span>&gt;</span><br><span class="line">                <span class="type">and</span> <span class="variable">status</span> <span class="operator">=</span> #&#123;status&#125;</span><br><span class="line">            &lt;/<span class="keyword">if</span>&gt;</span><br><span class="line">        &lt;/where&gt;</span><br><span class="line">        order by update_time desc</span><br></pre></td></tr></table></figure>

<p>删除菜品</p>
<ul>
<li>可以<code>一次删除</code>一个菜品，也可以<code>批量删除</code>菜品</li>
<li><code>起售中</code>的菜品<code>不能删除</code></li>
<li><code>被套餐关联</code>的菜品<code>不能删除</code></li>
<li>删除菜品后，关联的<code>口味数据</code>也需要<code>删除</code>掉</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">controller:  <span class="keyword">public</span> Result <span class="title function_">delete</span><span class="params">(<span class="meta">@RequestParam</span> List&lt;Long&gt; ids)</span>&#123;&#125;</span><br><span class="line">service :<span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 判断是否菜品是否能删除 1.查询当前菜品是否在售 2.查询当前菜品是否关联了套餐</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">    	 <span class="comment">//删除菜品数据 和 口味表数据</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>为什么要在项目中使用自定义异常？</p>
<table>
<thead>
<tr>
<th>痛点</th>
<th>自定义异常带来的好处</th>
</tr>
</thead>
<tbody><tr>
<td>① JDK 自带异常语义太泛</td>
<td><code>IllegalArgumentException</code>、<code>RuntimeException</code> 看不出“用户名已存在”“库存不足”等业务含义。</td>
</tr>
<tr>
<td>② 差异化处理困难</td>
<td>捕获到自定义异常后，可直接 <code>instanceof BizException</code> 做分支处理，不必解析 message。</td>
</tr>
<tr>
<td>③ 统一响应&#x2F;监控</td>
<td>可在自定义异常里携带 <strong>错误码</strong>、<strong>i18n 文案</strong>、<strong>日志级别</strong>，方便前端统一弹窗、运维监控报警。</td>
</tr>
<tr>
<td>④ 框架集成友好</td>
<td>Spring Security、Spring Validation、Spring Cloud Gateway 等都支持按异常类型做 <strong>全局异常映射</strong> 和 <strong>重试&#x2F;熔断</strong>策略。</td>
</tr>
</tbody></table>
<p>如何捕获这些异常？</p>
<table>
<thead>
<tr>
<th>场景</th>
<th>捕获方式</th>
</tr>
</thead>
<tbody><tr>
<td>普通 Java 代码</td>
<td><code>try &#123; ... &#125; catch (MyBizException e) &#123; ... &#125;</code></td>
</tr>
<tr>
<td>Spring Web</td>
<td><code>@RestControllerAdvice</code> + <code>@ExceptionHandler(MyBizException.class)</code> 统一返回 JSON。</td>
</tr>
<tr>
<td>Spring WebFlux &#x2F; Gateway</td>
<td><code>ErrorWebExceptionHandler</code> 或 <code>@ControllerAdvice</code>。</td>
</tr>
<tr>
<td>定时任务 &#x2F; 异步线程</td>
<td>在 <code>Runnable</code> 里显式 catch，或配合线程池的 <code>afterExecute</code> 钩子。</td>
</tr>
</tbody></table>
<h3 id="根据id查询菜品"><a href="#根据id查询菜品" class="headerlink" title="根据id查询菜品"></a>根据id查询菜品</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">service: <span class="type">Dish</span> <span class="variable">dish</span> <span class="operator">=</span> dishMapper.getById(id);</span><br><span class="line">        List&lt;DishFlavor&gt; dishFlavors = dishFlavorMapper.getByDishId(id);</span><br><span class="line">		再封装进dishVO</span><br></pre></td></tr></table></figure>

<h3 id="修改菜品"><a href="#修改菜品" class="headerlink" title="修改菜品"></a>修改菜品</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">serevice: 获得dish从dishDTO 调用mapper</span><br><span class="line">		删除原有的口味数据</span><br><span class="line">		从dishDTO获得 List&lt;DishFlavors&gt; flavors</span><br><span class="line">		为flavors插入dishId</span><br><span class="line">		调用mapper批量插入  if (flavors != null &amp;&amp; !flavors.isEmpty()) &#123;</span><br><span class="line">            dishFlavorMapper.insertBatch(flavors);</span><br><span class="line">        &#125;  注意条件否则会出错</span><br></pre></td></tr></table></figure>

<h2 id="Day-4"><a href="#Day-4" class="headerlink" title="Day-4"></a>Day-4</h2><h3 id="套餐管理模块所有业务功能"><a href="#套餐管理模块所有业务功能" class="headerlink" title="套餐管理模块所有业务功能"></a>套餐管理模块所有业务功能</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">注意批量删除 delete from setmeal where id in</span><br><span class="line">                                <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;ids&quot;</span> <span class="attr">item</span>=<span class="string">&quot;id&quot;</span> <span class="attr">open</span>=<span class="string">&quot;(&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span> <span class="attr">close</span>=<span class="string">&quot;)&quot;</span>&gt;</span></span><br><span class="line">                                   #&#123;id&#125;</span><br><span class="line">                                <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line">            //delete from setmeal where id in ( , , )</span><br></pre></td></tr></table></figure>

<h2 id="Day-5"><a href="#Day-5" class="headerlink" title="Day-5"></a>Day-5</h2><h3 id="Redis入门"><a href="#Redis入门" class="headerlink" title="Redis入门"></a>Redis入门</h3><h4 id="Redis概述"><a href="#Redis概述" class="headerlink" title="Redis概述"></a>Redis概述</h4><p><strong>主要特点：</strong> 🍐</p>
<ul>
<li>基于内存存储，读写性能高</li>
<li>适合存储热点数据（热点商品、资讯、新闻）</li>
<li>企业应用广泛</li>
</ul>
<p><strong>关系型数据库(RDBMS)：</strong></p>
<ul>
<li>Mysql 企业常用</li>
<li>Oracle 企业常用</li>
<li>DB2</li>
<li>SQLServer</li>
</ul>
<p><strong>非关系型数据库(NoSql)：</strong></p>
<ul>
<li>Redis 企业常用</li>
<li>Mongo db 企业常用</li>
<li>MemCached</li>
</ul>
<p>ai查询装docker redis   docker-compose up -d</p>
<h4 id="Redis数据类型"><a href="#Redis数据类型" class="headerlink" title="Redis数据类型"></a>Redis数据类型</h4><p><strong>5种常用的数据类型</strong></p>
<ul>
<li>字符串(string)：普通字符串，Redis中最简单的数据类型</li>
<li>哈希(hash)：也叫散列，类似于Java中的HashMap结构</li>
<li>列表(list)：按照插入顺序排序，可以有重复元素，类似于Java中的LinkedList</li>
<li>集合(set)：无序集合，没有重复元素，类似于Java中的HashSet</li>
<li>有序集合(sorted set&#x2F;zset)：集合中每个元素关联一个分数(score)，根据分数升序排序，没有重复元素</li>
</ul>
<p><img src="/../images/image-20250716151454167.png" alt="image-20250716151454167"></p>
<p>&#x3D;&#x3D;<strong>String</strong>&#x3D;&#x3D;</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"># 存入一个字符串</span><br><span class="line"><span class="keyword">set</span> name xiaoming</span><br><span class="line"># 获取name</span><br><span class="line"><span class="keyword">get</span> name</span><br><span class="line"></span><br><span class="line"># 存入一个age </span><br><span class="line"><span class="keyword">set</span> age <span class="number">20</span> </span><br><span class="line"><span class="keyword">set</span> age <span class="number">30</span></span><br><span class="line"># 获得age  </span><br><span class="line"><span class="keyword">get</span> age  #<span class="number">30</span> 覆盖了</span><br><span class="line"></span><br><span class="line"># 练习 SETEX key seconds <span class="keyword">value</span> 设置指定 key 的值，并将 key 的过期时间设为 seconds 秒</span><br><span class="line"># 设置存<span class="number">10</span>s </span><br><span class="line">setex city <span class="number">10</span> beijing</span><br><span class="line"></span><br><span class="line"># 等待<span class="number">10</span>秒</span><br><span class="line"><span class="keyword">get</span> city #返回nil <span class="comment">---&gt;空</span></span><br><span class="line"></span><br><span class="line"># 练习SETNX key <span class="keyword">value</span> 只有在 key 不存在时设置 key 的值</span><br><span class="line">setnx bookname zhuxian </span><br><span class="line"></span><br><span class="line">setnx bookname fanrenxiuxianzhuan</span><br><span class="line"></span><br><span class="line"><span class="keyword">get</span> bookname # 返回zhuxian</span><br><span class="line"></span><br><span class="line">## 注意不要传中文，返回类似这种</span><br><span class="line">&quot;\xe5\x87\xa1\xe4\xba\xba\xe4\xbf\xae\xe4\xbb\x99\xe8\xae\xb0&quot;</span><br><span class="line"># 在redis 中存储中文，默认读取不到中文，而是以十六进制的方式储存</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>&#x3D;&#x3D;<strong>Hash</strong>&#x3D;&#x3D;</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"># 往key 为001 存入 hash键值对 2对</span><br><span class="line">hset 001 name zhangsan</span><br><span class="line">hset 001 age  23</span><br><span class="line">hset 002 name lisi</span><br><span class="line">hset 002 age  16</span><br><span class="line"></span><br><span class="line"># 练习 HGET key field 获取存储在哈希表中指定字段的值</span><br><span class="line"># 获取002中的 name的值</span><br><span class="line">hget 002 name</span><br><span class="line"></span><br><span class="line"># 练习 HDEL key field 删除存储在哈希表中的指定字段</span><br><span class="line"># 删除 002 中的name</span><br><span class="line">hdel 002 name</span><br><span class="line"></span><br><span class="line"># 练习HKEYS key 获取哈希表中所有字段</span><br><span class="line">hkeys 002</span><br><span class="line"></span><br><span class="line"># 练习HVALS key 获取哈希表中所有值</span><br><span class="line">HVALS 002</span><br><span class="line"></span><br><span class="line"># 练习 HGETALL key 获取在哈希表中指定 key 的所有字段和值</span><br><span class="line"></span><br><span class="line">HGETALL 001</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>&#x3D;&#x3D;List&#x3D;&#x3D;</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"># LPUSH key value1 [value2] 将一个或多个值插入到列表头部</span><br><span class="line">LPUSH list1 a b c d</span><br><span class="line">LPUSH list2 1 2 3 4</span><br><span class="line">LPUSH list3 9 8 7 6</span><br><span class="line"></span><br><span class="line"># LRANGE key start stop 获取列表指定范围内的元素</span><br><span class="line">LRANGE list1 0 -1 # 查所有</span><br><span class="line"># a最先插入，所以在尾部</span><br><span class="line"></span><br><span class="line"># RPOP key 移除并获取列表最后一个元素</span><br><span class="line">RPOP list1 # 返回a   当然a没有了</span><br><span class="line"></span><br><span class="line"># LLEN key 获取列表长度</span><br><span class="line">LLEN list1  # 3</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># BRPOP key1 [key2 ] timeout 移出并获取列表的最后一个元素， 如果列表没有元素会阻塞列表直到等待超 时或发现可弹出元素为止</span><br><span class="line"></span><br><span class="line">BRPOP list1  10  </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>&#x3D;&#x3D;<strong>set</strong>&#x3D;&#x3D;</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"># SADD key member1 [member2] 向集合添加一个或多个成员</span><br><span class="line">SADD set1 a b c</span><br><span class="line">SADD set2 1 2 3</span><br><span class="line"></span><br><span class="line"># SMEMBERS key 返回集合中的所有成员</span><br><span class="line">SMEMBERS set1</span><br><span class="line"></span><br><span class="line"># SCARD key 获取集合的成员数</span><br><span class="line">SCARD  set1</span><br><span class="line"></span><br><span class="line"># SINTER key1 [key2] 返回给定所有集合的交集</span><br><span class="line"></span><br><span class="line">SINTER set1 set2 # a 交集是a</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># SUNION key1 [key2] 返回所有给定集合的并集</span><br><span class="line"></span><br><span class="line">SUNION set1 set2  # a b c 2 3</span><br><span class="line"></span><br><span class="line"># SDIFF key1 [key2] 返回给定所有集合的差集</span><br><span class="line"></span><br><span class="line">SDIFF set1 set2  #注意顺序 2者相减</span><br><span class="line"></span><br><span class="line"># SREM key member1 [member2] 移除集合中一个或多个成员</span><br><span class="line">SREM set1 a b # 删除元素</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>&#x3D;&#x3D;sorted set&#x3D;&#x3D;</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># ZADD key score1 member1 [score2 member2] 向有序集合添加一个或多个成员，或者更新已存在成员的 分数</span><br><span class="line">zadd sset1  0.1 a  3.0 b 2.5 c</span><br><span class="line">zadd sset2  9.9 p  8.8 w 2.0 q</span><br><span class="line"></span><br><span class="line"># ZRANGE key start stop [WITHSCORES] 通过索引区间返回有序集合中指定区间内的成员</span><br><span class="line">ZRANGE sset1 0 -1 # 获得全部</span><br><span class="line">ZRANGE sset1 0 -1  WITHSCORES # 分数也会显示</span><br><span class="line"></span><br><span class="line"># ZINCRBY key increment member 有序集合中对指定成员的分数加上增量 increment</span><br><span class="line">ZINCRBY  sset1 20 b #意味着b的分值改变了</span><br><span class="line"># 可以查询下</span><br><span class="line">ZRANGE sset1 0 -1  WITHSCORES</span><br><span class="line"></span><br><span class="line"># ZREM key member [member ...] 移除有序集合中的一个或多个成员</span><br><span class="line">ZREM sset1 b #将b这个元素移除</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="在Java中操作Redis"><a href="#在Java中操作Redis" class="headerlink" title="在Java中操作Redis"></a>在Java中操作Redis</h4><p>1.导入<strong>Spring Data Redis的maven坐标</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.5.15<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>2.<strong>配置Redis数据源</strong></p>
<p>在application-dev.yml中添加</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">sky:</span></span><br><span class="line">    <span class="attr">redis:</span></span><br><span class="line">      <span class="attr">host:</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.144</span></span><br><span class="line">      <span class="attr">port:</span> <span class="number">6379</span></span><br><span class="line">      <span class="attr">password:</span></span><br><span class="line">      <span class="attr">database:</span> <span class="number">10</span>  <span class="string">//Redis服务启动后默认有16个数据库，编号分别是从0到15。</span></span><br></pre></td></tr></table></figure>

<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">dev</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="string">$&#123;sky.redis.host&#125;</span></span><br><span class="line">    <span class="attr">port:</span> <span class="string">$&#123;sky.redis.port&#125;</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">$&#123;sky.redis.password&#125;</span></span><br><span class="line">    <span class="attr">database:</span> <span class="string">$&#123;sky.redis.database&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>3.<strong>编写配置类，创建RedisTemplate对象</strong></p>
<p>当前配置类不是必须的，因为 Spring Boot 框架会自动装配 RedisTemplate 对象，但是默认的key序列化器为</p>
<p>JdkSerializationRedisSerializer，导致我们存到Redis中后的数据和原始数据有差别，故设置为</p>
<p>StringRedisSerializer序列化器。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sky.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.connection.RedisConnectionFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.serializer.StringRedisSerializer;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> RedisTemplate <span class="title function_">redisTemplate</span><span class="params">(RedisConnectionFactory redisConnectionFactory)</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;开始创建redis模板对象...&quot;</span>);</span><br><span class="line">        <span class="type">RedisTemplate</span> <span class="variable">redisTemplate</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RedisTemplate</span>();</span><br><span class="line">        <span class="comment">//设置redis的连接工厂对象</span></span><br><span class="line">        redisTemplate.setConnectionFactory(redisConnectionFactory);</span><br><span class="line">        <span class="comment">//设置redis key的序列化器</span></span><br><span class="line">        redisTemplate.setKeySerializer(<span class="keyword">new</span> <span class="title class_">StringRedisSerializer</span>());</span><br><span class="line">        <span class="keyword">return</span> redisTemplate;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>操作string</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 操作字符串类型的数据</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testString</span><span class="params">()</span>&#123;</span><br><span class="line">       <span class="comment">// set get setex setnx</span></span><br><span class="line">       redisTemplate.opsForValue().set(<span class="string">&quot;name&quot;</span>,<span class="string">&quot;小明&quot;</span>);</span><br><span class="line">       <span class="type">String</span> <span class="variable">city</span> <span class="operator">=</span> (String) redisTemplate.opsForValue().get(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">       System.out.println(city);</span><br><span class="line">       <span class="comment">// 过期时间</span></span><br><span class="line">       redisTemplate.opsForValue().set(<span class="string">&quot;code&quot;</span>,<span class="string">&quot;1234&quot;</span>,<span class="number">3</span>, TimeUnit.MINUTES);</span><br><span class="line">       <span class="comment">// 存入前判断</span></span><br><span class="line">       redisTemplate.opsForValue().setIfAbsent(<span class="string">&quot;lock&quot;</span>,<span class="string">&quot;1&quot;</span>);</span><br><span class="line">       redisTemplate.opsForValue().setIfAbsent(<span class="string">&quot;lock&quot;</span>,<span class="string">&quot;2&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>操作哈希类型数据</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 操作哈希类型的数据</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testHash</span><span class="params">()</span>&#123;</span><br><span class="line">       <span class="comment">//hset hget hdel hkeys hvals</span></span><br><span class="line">       <span class="type">HashOperations</span> <span class="variable">hashOperations</span> <span class="operator">=</span> redisTemplate.opsForHash();</span><br><span class="line"></span><br><span class="line">       hashOperations.put(<span class="string">&quot;100&quot;</span>,<span class="string">&quot;name&quot;</span>,<span class="string">&quot;tom&quot;</span>);</span><br><span class="line">       hashOperations.put(<span class="string">&quot;100&quot;</span>,<span class="string">&quot;age&quot;</span>,<span class="string">&quot;20&quot;</span>);</span><br><span class="line"></span><br><span class="line">       <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> (String) hashOperations.get(<span class="string">&quot;100&quot;</span>, <span class="string">&quot;name&quot;</span>);</span><br><span class="line">       System.out.println(name);</span><br><span class="line"></span><br><span class="line">       <span class="type">Set</span> <span class="variable">keys</span> <span class="operator">=</span> hashOperations.keys(<span class="string">&quot;100&quot;</span>);</span><br><span class="line">       System.out.println(keys);</span><br><span class="line"></span><br><span class="line">       <span class="type">List</span> <span class="variable">values</span> <span class="operator">=</span> hashOperations.values(<span class="string">&quot;100&quot;</span>);</span><br><span class="line">       System.out.println(values);</span><br><span class="line"></span><br><span class="line">       hashOperations.delete(<span class="string">&quot;100&quot;</span>,<span class="string">&quot;age&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>操作列表类型数据</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 操作列表类型的数据</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testList</span><span class="params">()</span>&#123;</span><br><span class="line">       <span class="comment">//lpush lrange rpop llen</span></span><br><span class="line">       <span class="type">ListOperations</span> <span class="variable">listOperations</span> <span class="operator">=</span> redisTemplate.opsForList();</span><br><span class="line"></span><br><span class="line">       listOperations.leftPushAll(<span class="string">&quot;mylist&quot;</span>,<span class="string">&quot;a&quot;</span>,<span class="string">&quot;b&quot;</span>,<span class="string">&quot;c&quot;</span>);</span><br><span class="line">       listOperations.leftPush(<span class="string">&quot;mylist&quot;</span>,<span class="string">&quot;d&quot;</span>);</span><br><span class="line"></span><br><span class="line">       <span class="type">List</span> <span class="variable">mylist</span> <span class="operator">=</span> listOperations.range(<span class="string">&quot;mylist&quot;</span>, <span class="number">0</span>, -<span class="number">1</span>);</span><br><span class="line">       System.out.println(mylist);</span><br><span class="line"></span><br><span class="line">       listOperations.rightPop(<span class="string">&quot;mylist&quot;</span>);</span><br><span class="line"></span><br><span class="line">       <span class="type">Long</span> <span class="variable">size</span> <span class="operator">=</span> listOperations.size(<span class="string">&quot;mylist&quot;</span>);</span><br><span class="line">       System.out.println(size);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>操作集合类型数据</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 操作集合类型的数据</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSet</span><span class="params">()</span>&#123;</span><br><span class="line">       <span class="comment">//sadd smembers scard sinter sunion srem</span></span><br><span class="line">       <span class="type">SetOperations</span> <span class="variable">setOperations</span> <span class="operator">=</span> redisTemplate.opsForSet();</span><br><span class="line"></span><br><span class="line">       setOperations.add(<span class="string">&quot;set1&quot;</span>,<span class="string">&quot;a&quot;</span>,<span class="string">&quot;b&quot;</span>,<span class="string">&quot;c&quot;</span>,<span class="string">&quot;d&quot;</span>);</span><br><span class="line">       setOperations.add(<span class="string">&quot;set2&quot;</span>,<span class="string">&quot;a&quot;</span>,<span class="string">&quot;b&quot;</span>,<span class="string">&quot;x&quot;</span>,<span class="string">&quot;y&quot;</span>);</span><br><span class="line"></span><br><span class="line">       <span class="type">Set</span> <span class="variable">members</span> <span class="operator">=</span> setOperations.members(<span class="string">&quot;set1&quot;</span>);</span><br><span class="line">       System.out.println(members);</span><br><span class="line"></span><br><span class="line">       <span class="type">Long</span> <span class="variable">size</span> <span class="operator">=</span> setOperations.size(<span class="string">&quot;set1&quot;</span>);</span><br><span class="line">       System.out.println(size);</span><br><span class="line"></span><br><span class="line">       <span class="type">Set</span> <span class="variable">intersect</span> <span class="operator">=</span> setOperations.intersect(<span class="string">&quot;set1&quot;</span>, <span class="string">&quot;set2&quot;</span>);</span><br><span class="line">       System.out.println(intersect);</span><br><span class="line"></span><br><span class="line">       <span class="type">Set</span> <span class="variable">union</span> <span class="operator">=</span> setOperations.union(<span class="string">&quot;set1&quot;</span>, <span class="string">&quot;set2&quot;</span>);</span><br><span class="line">       System.out.println(union);</span><br><span class="line"></span><br><span class="line">       setOperations.remove(<span class="string">&quot;set1&quot;</span>,<span class="string">&quot;a&quot;</span>,<span class="string">&quot;b&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>操作有序集合类型数据</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 操作有序集合类型的数据</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testZset</span><span class="params">()</span>&#123;</span><br><span class="line">       <span class="comment">//zadd zrange zincrby zrem</span></span><br><span class="line">       <span class="type">ZSetOperations</span> <span class="variable">zSetOperations</span> <span class="operator">=</span> redisTemplate.opsForZSet();</span><br><span class="line"></span><br><span class="line">       zSetOperations.add(<span class="string">&quot;zset1&quot;</span>,<span class="string">&quot;a&quot;</span>,<span class="number">10</span>);</span><br><span class="line">       zSetOperations.add(<span class="string">&quot;zset1&quot;</span>,<span class="string">&quot;b&quot;</span>,<span class="number">12</span>);</span><br><span class="line">       zSetOperations.add(<span class="string">&quot;zset1&quot;</span>,<span class="string">&quot;c&quot;</span>,<span class="number">9</span>);</span><br><span class="line"></span><br><span class="line">       <span class="type">Set</span> <span class="variable">zset1</span> <span class="operator">=</span> zSetOperations.range(<span class="string">&quot;zset1&quot;</span>, <span class="number">0</span>, -<span class="number">1</span>);</span><br><span class="line">       System.out.println(zset1);</span><br><span class="line"></span><br><span class="line">       zSetOperations.incrementScore(<span class="string">&quot;zset1&quot;</span>,<span class="string">&quot;c&quot;</span>,<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">       zSetOperations.remove(<span class="string">&quot;zset1&quot;</span>,<span class="string">&quot;a&quot;</span>,<span class="string">&quot;b&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>通用命令操作</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 通用命令操作</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testCommon</span><span class="params">()</span>&#123;</span><br><span class="line">       <span class="comment">//keys exists type del</span></span><br><span class="line">       <span class="type">Set</span> <span class="variable">keys</span> <span class="operator">=</span> redisTemplate.keys(<span class="string">&quot;*&quot;</span>);</span><br><span class="line">       System.out.println(keys);</span><br><span class="line"></span><br><span class="line">       <span class="type">Boolean</span> <span class="variable">name</span> <span class="operator">=</span> redisTemplate.hasKey(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">       <span class="type">Boolean</span> <span class="variable">set1</span> <span class="operator">=</span> redisTemplate.hasKey(<span class="string">&quot;set1&quot;</span>);</span><br><span class="line"></span><br><span class="line">       <span class="keyword">for</span> (Object key : keys) &#123;</span><br><span class="line">           <span class="type">DataType</span> <span class="variable">type</span> <span class="operator">=</span> redisTemplate.type(key);</span><br><span class="line">           System.out.println(type.name());</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       redisTemplate.delete(<span class="string">&quot;mylist&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>Spring Boot 为我们自动配置了 RedisTemplate，而 RedisTemplate 使用的是 JdkSerializationRedisSerializer，这个对我们用 redis 图形化客户端很不直观，因为 JdkSerializationRedisSerializer 使用二进制形式储存数据，在此我们将自己配置 RedisTemplate 并定义 Serializer</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">在config包中配置</span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisCacheConfig</span> &#123;</span><br><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 配置redisTemplate bean，⾃定义数据的序列化的⽅式</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> redisConnectionFactory 连接redis的⼯⼚，底层有</span></span><br><span class="line"><span class="comment">场景依赖启动时，⾃动加载</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"> <span class="meta">@Bean(&quot;secondRedisTemplate&quot;)</span></span><br><span class="line"> <span class="keyword">public</span> RedisTemplate <span class="title function_">redisTemplate</span><span class="params">(<span class="meta">@Autowired</span> RedisConnectionFactory redisConnectionFactory)</span>&#123;</span><br><span class="line">    <span class="comment">//1.构建RedisTemplate模板对象</span></span><br><span class="line">    RedisTemplate&lt;String, Object&gt; template = newRedisTemplate&lt;&gt;();</span><br><span class="line">    template.setConnectionFactory(redisConnectionFactory);</span><br><span class="line">    <span class="comment">//2.为不同的数据结构设置不同的序列化⽅案</span></span><br><span class="line">    <span class="comment">//设置key序列化⽅式</span></span><br><span class="line">    template.setKeySerializer(<span class="keyword">new</span> <span class="title class_">StringRedisSerializer</span>());</span><br><span class="line">    <span class="comment">//设置value序列化⽅式</span></span><br><span class="line">    template.setValueSerializer(<span class="keyword">new</span> <span class="title class_">Jackson2JsonRedisSerializer</span>&lt;&gt;(Object.class));</span><br><span class="line">    <span class="comment">//设置hash中field字段序列化⽅式</span></span><br><span class="line">    template.setHashKeySerializer(<span class="keyword">new</span> <span class="title class_">StringRedisSerializer</span>());</span><br><span class="line">    <span class="comment">//设置hash中value的序列化⽅式</span></span><br><span class="line">    template.setHashValueSerializer(<span class="keyword">new</span> <span class="title class_">Jackson2JsonRedisSerializer</span>&lt;&gt;(Object.class));</span><br><span class="line">    <span class="comment">//5.初始化参数设置</span></span><br><span class="line">    template.afterPropertiesSet();</span><br><span class="line">    <span class="keyword">return</span> template;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="店铺营业状态设置"><a href="#店铺营业状态设置" class="headerlink" title="店铺营业状态设置"></a>店铺营业状态设置</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">@Autowired</span></span><br><span class="line">    <span class="meta">@Qualifier(&quot;secondRedisTemplate&quot;)</span></span><br><span class="line">    RedisTemplate redisTemplate;</span><br><span class="line">读取容器</span><br></pre></td></tr></table></figure>

<h3 id="Swagger接口分组"><a href="#Swagger接口分组" class="headerlink" title="Swagger接口分组"></a>Swagger接口分组</h3><p>在WebMvcConfiguration.java中，分别扫描<code>com.sky.controller.admin</code>和<code>com.sky.controller.user</code>这两个包。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line">   <span class="keyword">public</span> Docket <span class="title function_">docket1</span><span class="params">()</span>&#123;</span><br><span class="line">       log.info(<span class="string">&quot;准备生成接口文档...&quot;</span>);</span><br><span class="line">       <span class="type">ApiInfo</span> <span class="variable">apiInfo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ApiInfoBuilder</span>()</span><br><span class="line">               .title(<span class="string">&quot;苍穹外卖项目接口文档&quot;</span>)</span><br><span class="line">               .version(<span class="string">&quot;2.0&quot;</span>)</span><br><span class="line">               .description(<span class="string">&quot;苍穹外卖项目接口文档&quot;</span>)</span><br><span class="line">               .build();</span><br><span class="line"></span><br><span class="line">       <span class="type">Docket</span> <span class="variable">docket</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Docket</span>(DocumentationType.SWAGGER_2)</span><br><span class="line">               .groupName(<span class="string">&quot;管理端接口&quot;</span>)</span><br><span class="line">               .apiInfo(apiInfo)</span><br><span class="line">               .select()</span><br><span class="line">               <span class="comment">//指定生成接口需要扫描的包</span></span><br><span class="line">               .apis(RequestHandlerSelectors.basePackage(<span class="string">&quot;com.sky.controller.admin&quot;</span>))</span><br><span class="line">               .paths(PathSelectors.any())</span><br><span class="line">               .build();</span><br><span class="line"></span><br><span class="line">       <span class="keyword">return</span> docket;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Bean</span></span><br><span class="line">   <span class="keyword">public</span> Docket <span class="title function_">docket2</span><span class="params">()</span>&#123;</span><br><span class="line">       log.info(<span class="string">&quot;准备生成接口文档...&quot;</span>);</span><br><span class="line">       <span class="type">ApiInfo</span> <span class="variable">apiInfo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ApiInfoBuilder</span>()</span><br><span class="line">               .title(<span class="string">&quot;苍穹外卖项目接口文档&quot;</span>)</span><br><span class="line">               .version(<span class="string">&quot;2.0&quot;</span>)</span><br><span class="line">               .description(<span class="string">&quot;苍穹外卖项目接口文档&quot;</span>)</span><br><span class="line">               .build();</span><br><span class="line"></span><br><span class="line">       <span class="type">Docket</span> <span class="variable">docket</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Docket</span>(DocumentationType.SWAGGER_2)</span><br><span class="line">               .groupName(<span class="string">&quot;用户端接口&quot;</span>)</span><br><span class="line">               .apiInfo(apiInfo)</span><br><span class="line">               .select()</span><br><span class="line">               <span class="comment">//指定生成接口需要扫描的包</span></span><br><span class="line">               .apis(RequestHandlerSelectors.basePackage(<span class="string">&quot;com.sky.controller.user&quot;</span>))</span><br><span class="line">               .paths(PathSelectors.any())</span><br><span class="line">               .build();</span><br><span class="line"></span><br><span class="line">       <span class="keyword">return</span> docket;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="Day-6"><a href="#Day-6" class="headerlink" title="Day-6"></a>Day-6</h2><h3 id="HttpClient"><a href="#HttpClient" class="headerlink" title="HttpClient"></a>HttpClient</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.httpcomponents<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>httpclient<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.5.13<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>HttpClient的核心API：</strong> 👇</p>
<ul>
<li>HttpClient：Http客户端对象类型，使用该类型对象可发起Http请求。</li>
<li>HttpClients：可认为是构建器，可创建HttpClient对象。</li>
<li>CloseableHttpClient：实现类，实现了HttpClient接口。</li>
<li>HttpGet：Get方式请求类型。</li>
<li>HttpPost：Post方式请求类型。</li>
</ul>
<p><strong>代码操作</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.aliyun.oss<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aliyun-sdk-oss<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>上述依赖的底层已经包含了HttpClient相关依赖</strong></p>
<p>Get请求实现</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sky.test;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HttpClientTest</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 测试通过httpclient发送GET方式的请求</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test07</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line"><span class="comment">// 创建httpclient对象</span></span><br><span class="line">    <span class="type">CloseableHttpClient</span> <span class="variable">httpClient</span> <span class="operator">=</span> HttpClients.createDefault();</span><br><span class="line">    <span class="comment">//创建请求对象</span></span><br><span class="line">    <span class="type">HttpGet</span> <span class="variable">httpPost</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HttpGet</span>(<span class="string">&quot;https://query.asilu.com/weather/baidu/?city=长沙&quot;</span>);</span><br><span class="line">    <span class="comment">//发送请求</span></span><br><span class="line">    <span class="type">CloseableHttpResponse</span> <span class="variable">response</span> <span class="operator">=</span> httpClient.execute(httpPost);</span><br><span class="line">    <span class="comment">//解析返回结果</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">statusCode</span> <span class="operator">=</span> response.getStatusLine().getStatusCode();</span><br><span class="line">    System.out.println(<span class="string">&quot;响应码为：&quot;</span> + statusCode);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//判断响应状态</span></span><br><span class="line">    <span class="keyword">if</span>(statusCode == <span class="number">200</span>)&#123;</span><br><span class="line">        <span class="type">String</span>  <span class="variable">result</span> <span class="operator">=</span> EntityUtils.toString(response.getEntity(),<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;响应数据为：&quot;</span> + result);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//关闭资源</span></span><br><span class="line">    response.close();</span><br><span class="line">    httpClient.close();</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>post请求</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 测试通过httpclient发送POST方式的请求</span></span><br><span class="line"><span class="comment">    1.创建httpclient对象</span></span><br><span class="line"><span class="comment">    2.创建请求对象</span></span><br><span class="line"><span class="comment">    3.为请求对象设置entity(包含json内容 请求编码方式 数据格式)</span></span><br><span class="line"><span class="comment">    4.发送请求</span></span><br><span class="line"><span class="comment">    5.解析返回结果</span></span><br><span class="line"><span class="comment">    6.关闭资源</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testPOST</span><span class="params">()</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">    <span class="comment">// 创建httpclient对象</span></span><br><span class="line">    <span class="type">CloseableHttpClient</span> <span class="variable">httpClient</span> <span class="operator">=</span> HttpClients.createDefault();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//创建请求对象</span></span><br><span class="line">    <span class="type">HttpPost</span> <span class="variable">httpPost</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HttpPost</span>(<span class="string">&quot;http://localhost:8080/admin/employee/login&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">JSONObject</span> <span class="variable">jsonObject</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONObject</span>();</span><br><span class="line">    jsonObject.put(<span class="string">&quot;username&quot;</span>,<span class="string">&quot;admin&quot;</span>);</span><br><span class="line">    jsonObject.put(<span class="string">&quot;password&quot;</span>,<span class="string">&quot;123456&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">StringEntity</span> <span class="variable">entity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringEntity</span>(jsonObject.toString());</span><br><span class="line">    <span class="comment">//指定请求编码方式</span></span><br><span class="line">    entity.setContentEncoding(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">    <span class="comment">//数据格式</span></span><br><span class="line">    entity.setContentType(<span class="string">&quot;application/json&quot;</span>);</span><br><span class="line">    httpPost.setEntity(entity);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//发送请求</span></span><br><span class="line">    <span class="type">CloseableHttpResponse</span> <span class="variable">response</span> <span class="operator">=</span> httpClient.execute(httpPost);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//解析返回结果</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">statusCode</span> <span class="operator">=</span> response.getStatusLine().getStatusCode();</span><br><span class="line">    System.out.println(<span class="string">&quot;响应码为：&quot;</span> + statusCode);</span><br><span class="line"></span><br><span class="line">    <span class="type">HttpEntity</span> <span class="variable">entity1</span> <span class="operator">=</span> response.getEntity();</span><br><span class="line">    <span class="type">String</span> <span class="variable">body</span> <span class="operator">=</span> EntityUtils.toString(entity1);</span><br><span class="line">    System.out.println(<span class="string">&quot;响应数据为：&quot;</span> + body);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//关闭资源</span></span><br><span class="line">    response.close();</span><br><span class="line">    httpClient.close();</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="微信小程序开发"><a href="#微信小程序开发" class="headerlink" title="微信小程序开发"></a>微信小程序开发</h3><p>小程序的开发本质上属于前端开发，主要使用<strong>JavaScript</strong>开发</p>
<p>每个小程序页面主要由四个文件组成：</p>
<ul>
<li><strong>js文件：</strong> 必须存在，存放<strong>页面业务逻辑代码，编写的js代码</strong> 。</li>
<li><strong>wxml文件：</strong> 必须存在，存放页面结构，主要是做页面布局，页面效果展示的，<strong>类似于HTML页面</strong></li>
<li><strong>json文件：</strong> 非必须，<strong>存放页面相关的配置</strong> 。</li>
<li><strong>wxss文件：</strong> 非必须，存放页面样式表，<strong>相当于CSS文件</strong> 。</li>
</ul>
<h3 id="微信登录流程"><a href="#微信登录流程" class="headerlink" title="微信登录流程"></a>微信登录流程</h3><p><img src="/../images/image-20250717110625544.png" alt="image-20250717110625544"></p>
<h3 id="OpenID-与授权码的区别"><a href="#OpenID-与授权码的区别" class="headerlink" title="OpenID 与授权码的区别"></a>OpenID 与授权码的区别</h3><table>
<thead>
<tr>
<th>项目</th>
<th>OpenID</th>
<th>授权码</th>
</tr>
</thead>
<tbody><tr>
<td><strong>本质</strong></td>
<td>用户身份标识</td>
<td>临时交换凭证</td>
</tr>
<tr>
<td><strong>作用</strong></td>
<td>识别用户</td>
<td>换取 openid 和 session_key</td>
</tr>
<tr>
<td><strong>生命周期</strong></td>
<td>永久不变</td>
<td>一次性、短时效</td>
</tr>
<tr>
<td><strong>使用方</strong></td>
<td>前后端都可</td>
<td>仅后端使用</td>
</tr>
<tr>
<td><strong>是否敏感</strong></td>
<td>否（可前端使用）</td>
<td>是（禁止暴露前端）</td>
</tr>
</tbody></table>
<h3 id="微信登陆集成"><a href="#微信登陆集成" class="headerlink" title="微信登陆集成"></a>微信登陆集成</h3><ol>
<li><p>定义相关配置</p>
<ul>
<li>配置微信登录所需配置项</li>
<li>配置为微信用户生成jwt令牌时使用的配置项</li>
</ul>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">application-dev.yml</span></span><br><span class="line"><span class="string">(sky</span> <span class="string">与</span> <span class="string">spring</span> <span class="string">同级)</span></span><br><span class="line"><span class="attr">sky:</span></span><br><span class="line">  <span class="attr">wechat:</span></span><br><span class="line">    <span class="attr">appid:</span> <span class="string">wxffb3637a228223b8</span> <span class="comment"># appid 开放平台获取</span></span><br><span class="line">    <span class="attr">secret:</span> <span class="string">84311df9199ecacdf4f12d27b6b9522d</span> <span class="comment"># 秘钥 开放平台获取</span></span><br><span class="line"><span class="string">application.yml</span></span><br><span class="line"><span class="attr">sky:</span></span><br><span class="line">  <span class="attr">wechat:</span></span><br><span class="line">    <span class="attr">appid:</span> <span class="string">$&#123;sky.wechat.appid&#125;</span></span><br><span class="line">    <span class="attr">secret:</span> <span class="string">$&#123;sky.wechat.secret&#125;</span></span><br><span class="line">  <span class="attr">jwt:</span></span><br><span class="line">    <span class="comment"># 设置jwt签名加密时使用的秘钥</span></span><br><span class="line">    <span class="attr">admin-secret-key:</span> <span class="string">itcast</span></span><br><span class="line">    <span class="comment"># 设置jwt过期时间</span></span><br><span class="line">    <span class="attr">admin-ttl:</span> <span class="number">7200000</span></span><br><span class="line">    <span class="comment"># 设置前端传递过来的令牌名称</span></span><br><span class="line">    <span class="attr">admin-token-name:</span> <span class="string">token</span></span><br><span class="line">    <span class="attr">user-secret-key:</span> <span class="string">itheima</span></span><br><span class="line">    <span class="attr">user-ttl:</span> <span class="number">7200000</span></span><br><span class="line">    <span class="attr">user-token-name:</span> <span class="string">authentication</span>          <span class="comment">#管理端和用户端的token不一致</span></span><br></pre></td></tr></table></figure>


</li>
<li><p>根据传入参数设计DTO类</p>
</li>
<li><p>根据返回数据设计VO类</p>
</li>
<li><p>根据接口定义创建UserController的login方法</p>
</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1.注入Uservice JWTproperties</span><br><span class="line">2.userService.Login(..DTO)得到user对象</span><br><span class="line">3.生成jwt令牌：初始化一个hashmap claims,放入键值(username,user.getId())</span><br><span class="line">			JwtUtil.createJWT(JWTproperties的密钥和过期时间以及claims)</span><br><span class="line">4.构造一个userLoginVO(id,openid,token)</span><br></pre></td></tr></table></figure>



<p>  5.创建UserService接口</p>
<p> 6.创建UserServiceImpl实现类</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">1.构造常量 WX_LOGIN_URL</span><br><span class="line">2.注入 UserMapper  WeChatProperties</span><br><span class="line">3.设计一个getOpenId方法：</span><br><span class="line">	初始化一个hashmap 放入键值:appid secret js_code gant_type</span><br><span class="line">	HttpClientUtil.doGet(WX_LOGIN_URL,map) 返回json</span><br><span class="line">	JSON.parseObejct(json) 得到JSONObject</span><br><span class="line">	拿到openid = JSONObject.getString(&quot;openid&quot;)</span><br><span class="line">4.调用getOpenId方法拿到openid </span><br><span class="line">5.如果openid == null 抛出异常</span><br><span class="line">6.判断是否为新用户，调用userMapper</span><br><span class="line">7.if(user == null) 构造一个user 调用usrMapper插入</span><br></pre></td></tr></table></figure>



<p>  7.创建UserMapper接口和映射文件</p>
<ol start="8">
<li>编写拦截器</li>
</ol>
<ul>
<li>编写拦截器JwtTokenUserInterceptor</li>
<li>在WebMvcConfiguration配置类中注册拦截器</li>
</ul>
<p><strong>JwtTokenUserInterceptor</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span><span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span></span><br><span class="line"><span class="number">2.</span>注入jwtproperties</span><br><span class="line"><span class="number">3.</span> <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception &#123;&#125;</span><br><span class="line"><span class="number">4.</span>判断拦截的是否是Controller的方法</span><br><span class="line"><span class="number">5.</span>从请求头中获取token</span><br><span class="line"><span class="number">6.</span>JwtUtil.parseJWT(jwtproperties的密钥，token)解密得到claims</span><br><span class="line"><span class="number">7.</span>从claims拿到userId</span><br><span class="line"><span class="number">8.</span>在BaseContext设置userId</span><br><span class="line"><span class="number">9.</span>如果有问题 response.setStatus(<span class="number">401</span>)</span><br><span class="line">    <span class="keyword">return</span> flase</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">WebMvcConfiguration</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> JwtTokenUserInterceptor jwtTokenUserInterceptor;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 注册自定义拦截器</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> registry</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> &#123;</span><br><span class="line">    log.info(<span class="string">&quot;开始注册自定义拦截器...&quot;</span>);</span><br><span class="line">    <span class="comment">//.........</span></span><br><span class="line"></span><br><span class="line">    registry.addInterceptor(jwtTokenUserInterceptor)</span><br><span class="line">            .addPathPatterns(<span class="string">&quot;/user/**&quot;</span>)</span><br><span class="line">            .excludePathPatterns(<span class="string">&quot;/user/user/login&quot;</span>)</span><br><span class="line">            .excludePathPatterns(<span class="string">&quot;/user/shop/status&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="菜品浏览功能"><a href="#菜品浏览功能" class="headerlink" title="菜品浏览功能"></a>菜品浏览功能</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mapper:      <span class="variable">@Select</span>(&quot;select sd.name, sd.copies, d.image, d.description &quot; <span class="operator">+</span></span><br><span class="line">            &quot;from setmeal_dish sd left join dish d on sd.dish_id = d.id &quot; <span class="operator">+</span></span><br><span class="line">            &quot;where sd.setmeal_id = #&#123;setmealId&#125;&quot;)</span><br><span class="line">    List<span class="operator">&lt;</span>DishItemVO<span class="operator">&gt;</span> getDishItemBySetmealId(Long setmealId);</span><br></pre></td></tr></table></figure>

<h2 id="Day-7"><a href="#Day-7" class="headerlink" title="Day-7"></a>Day-7</h2><h3 id="缓存菜品"><a href="#缓存菜品" class="headerlink" title="缓存菜品"></a>缓存菜品</h3><p>用户端小程序展示的菜品数据都是通过查询数据库获得，如果<strong>用户端访问量比较大,数据库</strong> 访问压力随之增大。</p>
<p>通过Redis缓存菜品数据</p>
<p><img src="/../images/image-20250717163537686.png" alt="image-20250717163537686"></p>
<p>修改用户端接口 DishController 的 list 方法，加入缓存处理逻辑</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1.注入RedisTemplate</span><br><span class="line">2.构造redis的key dish_+categoryId</span><br><span class="line">3.查询redis是否存在菜品数据</span><br><span class="line">4.如果没有查询数据库获得数据</span><br><span class="line">5.将数据放在redis里</span><br><span class="line">6.返回数据</span><br></pre></td></tr></table></figure>

<p>为了保证<strong>数据库</strong>和<strong>Redis</strong>中的数据保持一致，修改<strong>管理端接口 DishController</strong> 的相关方法，加入清理缓存逻辑。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1.注入RedisTemplate</span><br><span class="line">2.设计方法clanCache(String key)</span><br><span class="line"></span><br><span class="line">有的删除全部缓存：&quot;dish_*&quot;</span><br></pre></td></tr></table></figure>

<p>redis序列化问题！！</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">导入依赖</span><br><span class="line">            <span class="comment">&lt;!-- Jackson 支持 Java 8 时间类型的模块 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-databind<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.14.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.datatype<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-datatype-jsr310<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.14.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>redisconfig</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sky.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.SerializationFeature;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.datatype.jsr310.JavaTimeModule;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.connection.RedisConnectionFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.serializer.Jackson2JsonRedisSerializer;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.serializer.StringRedisSerializer;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> RedisTemplate&lt;String, Object&gt; <span class="title function_">redisTemplate</span><span class="params">(RedisConnectionFactory factory)</span> &#123;</span><br><span class="line">        RedisTemplate&lt;String, Object&gt; template = <span class="keyword">new</span> <span class="title class_">RedisTemplate</span>&lt;&gt;();</span><br><span class="line">        template.setConnectionFactory(factory);</span><br><span class="line"></span><br><span class="line">        <span class="type">ObjectMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br><span class="line">        mapper.registerModule(<span class="keyword">new</span> <span class="title class_">JavaTimeModule</span>());</span><br><span class="line">        mapper.disable(SerializationFeature.WRITE_DATES_AS_TIMESTAMPS);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ✅ 正确方式：先创建序列化器，再设置 ObjectMapper</span></span><br><span class="line">        Jackson2JsonRedisSerializer&lt;Object&gt; serializer = <span class="keyword">new</span> <span class="title class_">Jackson2JsonRedisSerializer</span>&lt;&gt;(Object.class);</span><br><span class="line">        serializer.setObjectMapper(mapper);</span><br><span class="line"></span><br><span class="line">        template.setKeySerializer(<span class="keyword">new</span> <span class="title class_">StringRedisSerializer</span>());</span><br><span class="line">        template.setHashKeySerializer(<span class="keyword">new</span> <span class="title class_">StringRedisSerializer</span>());</span><br><span class="line">        template.setValueSerializer(serializer);</span><br><span class="line">        template.setHashValueSerializer(serializer);</span><br><span class="line">        template.afterPropertiesSet();</span><br><span class="line">        <span class="keyword">return</span> template;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="为什么要使用Redis做缓存"><a href="#为什么要使用Redis做缓存" class="headerlink" title="为什么要使用Redis做缓存"></a>为什么要使用Redis做缓存</h3><ol>
<li><strong>快</strong>：纯内存 KV 存储，单机 10w+ QPS，远高于 MySQL 磁盘读写。</li>
<li><strong>减轻后端压力</strong>：热点数据（商品、配置、验证码）先读缓存，90% 请求被挡在缓存层。</li>
<li><strong>削峰填谷</strong>：突发流量只打 Redis，后端数据库保持平稳。</li>
<li><strong>功能丰富</strong>：支持 TTL、LRU、LFU、分布式锁、Stream、Lua 脚本，可玩性强。</li>
</ol>
<h3 id="怎么保障数据一致性"><a href="#怎么保障数据一致性" class="headerlink" title="怎么保障数据一致性"></a>怎么保障数据一致性</h3><table>
<thead>
<tr>
<th>方案</th>
<th>实现思路</th>
<th>一致性</th>
<th>复杂度</th>
<th>场景</th>
</tr>
</thead>
<tbody><tr>
<td>① Cache Aside（旁路缓存）</td>
<td>读：先查缓存→无则查库→写缓存；写：先写库→删缓存</td>
<td>最终一致</td>
<td>★</td>
<td>最常用</td>
</tr>
<tr>
<td>② Write Through</td>
<td>写：同时写缓存+DB（同步写）；读：只读缓存</td>
<td>强一致</td>
<td>★★★</td>
<td>银行账务</td>
</tr>
<tr>
<td>③ Write Behind</td>
<td>写：先写缓存→异步批量刷库</td>
<td>最终一致</td>
<td>★★</td>
<td>高吞吐日志</td>
</tr>
<tr>
<td>④ 双写 + 延迟双删</td>
<td>写：先删缓存→写库→延迟再删一次</td>
<td>最终一致</td>
<td>★★</td>
<td>并发极高</td>
</tr>
<tr>
<td>⑤ 分布式锁</td>
<td>写操作加锁，串行化读写</td>
<td>强一致</td>
<td>★★★</td>
<td>库存扣减</td>
</tr>
</tbody></table>
<p><strong>更新数据先操作数据库，再操作缓存；读数据先查缓存，再回落数据库。</strong><br>配合 TTL 兜底 + 延迟双删 + 分布式锁，可覆盖 99% 实际场景。</p>
<h3 id="用了-Redis-就一定能高并发吗？"><a href="#用了-Redis-就一定能高并发吗？" class="headerlink" title="用了 Redis 就一定能高并发吗？"></a><strong>用了 Redis 就一定能高并发吗？</strong></h3><p> <strong>不一定！</strong> Redis 只是“工具”，高并发是系统工程：</p>
<table>
<thead>
<tr>
<th>风险点</th>
<th>可能踩坑示例</th>
</tr>
</thead>
<tbody><tr>
<td><strong>单机瓶颈</strong></td>
<td>单节点 10w QPS，业务 100w QPS 时直接打挂。→ <strong>集群&#x2F;分片</strong></td>
</tr>
<tr>
<td><strong>大 Value</strong></td>
<td>单个 Key 50 MB，网络阻塞。→ <strong>拆 Key、压缩、分页</strong></td>
</tr>
<tr>
<td><strong>热 Key</strong></td>
<td>某爆款商品 Key 被 10w 并发读，单节点 CPU 100%。→ <strong>本地缓存 + 热 Key 拆分</strong></td>
</tr>
<tr>
<td><strong>缓存击穿</strong></td>
<td>热点 Key 失效瞬间流量打到 DB。→ <strong>互斥锁 + 永不过期 + 异步刷新</strong></td>
</tr>
<tr>
<td><strong>缓存雪崩</strong></td>
<td>大量 Key 同时过期。→ <strong>随机 TTL + 预热 + 降级</strong></td>
</tr>
<tr>
<td><strong>缓存穿透</strong></td>
<td>查询不存在的数据。→ <strong>布隆过滤器 + 空值缓存</strong></td>
</tr>
</tbody></table>
<p><strong>Redis 是“高速公路”，但限速、车祸、堵车一样会发生；高并发 &#x3D; 缓存策略 + 架构设计 + 容量规划 + 故障预案。</strong></p>
<h3 id="Spring-Cache"><a href="#Spring-Cache" class="headerlink" title="Spring Cache"></a>Spring Cache</h3><p>Spring Cache是一个框架，实现了<strong>基于注解</strong> 的缓存功能，<strong>只需要简单地加一个注解，就能实现缓存功能</strong>。简单易用</p>
<p>Spring Cache 提供了一层抽象，底层可以切换不同的缓存实现，例如：</p>
<ul>
<li>EHCache</li>
<li>Caffeine</li>
<li>Redis(如果配置了Redis,则使用其缓存) 企业常用</li>
</ul>
<h4 id="常用注解"><a href="#常用注解" class="headerlink" title="常用注解"></a>常用注解</h4><table>
<thead>
<tr>
<th><strong>注解</strong></th>
<th><strong>说明</strong></th>
</tr>
</thead>
<tbody><tr>
<td>@EnableCaching</td>
<td>开启缓存注解功能，通常加在启动类上</td>
</tr>
<tr>
<td>@Cacheable</td>
<td>在方法执行前先查询缓存中是否有数据，如果有数据，则直接返回缓存数据；如果没有缓存数据，调用方法并将方法返回值放到缓存中</td>
</tr>
<tr>
<td>@CachePut</td>
<td>将方法的返回值放到缓存中</td>
</tr>
<tr>
<td>@CacheEvict</td>
<td>将一条或多条数据从缓存中删除</td>
</tr>
</tbody></table>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-cache<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.7.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="入门"><a href="#入门" class="headerlink" title="入门"></a>入门</h4><p>在启动类加上@EnableCaching&#x2F;&#x2F;开启缓存注解功能</p>
<p>方法上加**@CachePut**</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">作用: 将方法返回值，放入缓存</span><br><span class="line"></span><br><span class="line">value: 缓存的名称, 每个缓存名称下面可以有很多key</span><br><span class="line"></span><br><span class="line">key: 缓存的key </span><br><span class="line"></span><br><span class="line"><span class="meta">@PostMapping</span></span><br><span class="line">    <span class="meta">@CachePut(value = &quot;userCache&quot;, key = &quot;#user.id&quot;)</span><span class="comment">//key的生成：userCache::1</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">save</span><span class="params">(<span class="meta">@RequestBody</span> User user)</span>&#123;</span><br><span class="line">        userMapper.insert(user);</span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">key 的写法如下</span><br><span class="line"></span><br><span class="line">#user.id 常用: #user指的是方法形参的名称, id指的是user的id属性 , 也就是使用user的id属性作为key ;</span><br><span class="line">#result.id : #result代表方法返回值，该表达式 代表以返回对象的id属性作为key ；</span><br><span class="line">#p0.id：#p0指的是方法中的第一个参数，id指的是第一个参数的id属性,也就是使用第一个参数的id属性作为key ;</span><br><span class="line">#a0.id：#a0指的是方法中的第一个参数，id指的是第一个参数的id属性,也就是使用第一个参数的id属性作为key ;</span><br><span class="line">#root.args[<span class="number">0</span>].id:#root.args[<span class="number">0</span>]指的是方法中的第一个参数，id指的是第一个参数的id属性,也就是使用第一个参数的id属性作为key ;	 	</span><br></pre></td></tr></table></figure>

<p><strong>@Cacheable</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">作用: 在方法执行前，spring 先查看缓存中是否有数据，如果有数据，则直接返回缓存数据；若没有数据，调用方法并将方法返回值放到缓存中</span><br><span class="line"></span><br><span class="line">cacheNames: 缓存的名称，每个缓存名称下面可以有多个key</span><br><span class="line"></span><br><span class="line">key: 缓存的key</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* Cacheable：在方法执行前spring先查看缓存中是否有数据，如果有数据，则直接返回缓存数据；若没有数据，	  *调用方法并将方法返回值放到缓存中</span></span><br><span class="line"><span class="comment">* cacheNames：缓存的名称，每个缓存名称下面可以有多个key</span></span><br><span class="line"><span class="comment">* key：缓存的key</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@GetMapping</span></span><br><span class="line"><span class="meta">@Cacheable(cacheNames = &quot;userCache&quot;,key=&quot;#id&quot;)</span></span><br><span class="line"><span class="keyword">public</span> User <span class="title function_">getById</span><span class="params">(Long id)</span>&#123;</span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userMapper.getById(id);</span><br><span class="line">    <span class="keyword">return</span> user;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>@CacheEvict</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">作用: 清理指定缓存</span><br><span class="line"></span><br><span class="line">cacheNames: 缓存的名称，每个缓存名称下面可以有多个key</span><br><span class="line"></span><br><span class="line">key: 缓存的key </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@DeleteMapping</span><br><span class="line">@CacheEvict(cacheNames = &quot;userCache&quot;,key = &quot;#id&quot;)//删除某个key对应的缓存数据</span><br><span class="line">public void deleteById(Long id)&#123;</span><br><span class="line">    userMapper.deleteById(id);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@DeleteMapping(&quot;/delAll&quot;)</span><br><span class="line">@CacheEvict(cacheNames = &quot;userCache&quot;,allEntries = true)//删除userCache下所有的缓存数据</span><br><span class="line">public void deleteAll()&#123;</span><br><span class="line">    userMapper.deleteAll();</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p> <strong>@Cacheable 注解的作用</strong></p>
<p>把方法的<strong>返回结果</strong>放进缓存，后续用<strong>同样的参数</strong>再调用时，<strong>直接拿缓存，不再执行方法体</strong>。<br>典型场景：</p>
<ul>
<li>查询商品详情</li>
<li>查用户信息</li>
<li>查字典&#x2F;配置表</li>
</ul>
<table>
<thead>
<tr>
<th>操作类型</th>
<th>是否适合加 @Cacheable</th>
<th>举例</th>
</tr>
</thead>
<tbody><tr>
<td><strong>查询（SELECT）</strong></td>
<td>✅ 非常适合</td>
<td><code>getUserById(Long id)</code></td>
</tr>
<tr>
<td><strong>新增（INSERT）</strong></td>
<td>❌ 不适合</td>
<td><code>saveUser(User user)</code></td>
</tr>
<tr>
<td><strong>修改（UPDATE）</strong></td>
<td>❌ 不适合</td>
<td><code>updateUser(User user)</code></td>
</tr>
<tr>
<td><strong>删除（DELETE）</strong></td>
<td>❌ 不适合</td>
<td><code>deleteUser(Long id)</code></td>
</tr>
</tbody></table>
<p><strong>#result.id 与 #user.id 的区别</strong></p>
<table>
<thead>
<tr>
<th>表达式</th>
<th>来源</th>
<th>示例场景</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td><code>#user.id</code></td>
<td><strong>方法形参</strong> <code>user</code> 的 <code>id</code> 属性</td>
<td><code>public User get(User user)</code></td>
<td>方法<strong>执行前</strong>就能拿到</td>
</tr>
<tr>
<td><code>#result.id</code></td>
<td><strong>方法返回值</strong> 的 <code>id</code> 属性</td>
<td><code>public User get(Long id)</code></td>
<td>方法<strong>执行后</strong>才出现；<strong>只能用于 <code>@CacheEvict</code>&#x2F;<code>@Cacheable</code> 的 <code>unless</code>&#x2F;<code>condition</code>，不能用于 <code>@CachePut</code> 的 <code>key</code></strong></td>
</tr>
</tbody></table>
<h3 id="套餐缓存"><a href="#套餐缓存" class="headerlink" title="套餐缓存"></a>套餐缓存</h3><ol>
<li>导入Spring Cache和Redis相关maven坐标</li>
<li>在启动类上加入<code>@EnableCaching</code>注解，开启缓存注解功能</li>
<li>在用户端接口<code>SetmealController</code>的 <code>list</code> 方法上加入<code>@Cacheable</code>注解</li>
<li>在管理端接口<code>SetmealController</code>的 save、delete、update、startOrStop等方法上加入<code>CacheEvict</code>注解</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.cache.annotation.Cacheable;  要用这个</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Cacheable(cacheNames = &quot;setmealCache&quot;,key = &quot;#categoryId&quot;)</span> <span class="comment">//key: setmealCache::100</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@CacheEvict(cacheNames = &quot;setmealCache&quot;,allEntries = true)</span></span><br></pre></td></tr></table></figure>

<h3 id="添加购物车"><a href="#添加购物车" class="headerlink" title="添加购物车"></a>添加购物车</h3><p><img src="/../images/image-20250718091819227.png" alt="image-20250718091819227"></p>
<h3 id="其余购物车功能"><a href="#其余购物车功能" class="headerlink" title="其余购物车功能"></a>其余购物车功能</h3><h2 id="DAY-8"><a href="#DAY-8" class="headerlink" title="DAY-8"></a>DAY-8</h2><h3 id="导入地址簿功能"><a href="#导入地址簿功能" class="headerlink" title="导入地址簿功能"></a>导入地址簿功能</h3><h3 id="用户下单"><a href="#用户下单" class="headerlink" title="用户下单"></a>用户下单</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">service:</span><br><span class="line"><span class="number">1.</span>异常情况的处理(收获地址为空，超出配送范围，购物车为空)</span><br><span class="line"><span class="number">2.</span>构造订单数据</span><br><span class="line"><span class="number">3.</span>向order插入一条数据 useGeneratedKeys=<span class="string">&quot;true&quot;</span> keyProperty=<span class="string">&quot;id&quot;</span></span><br><span class="line"><span class="number">4.</span>构造订单明细数据集合 setOrderId</span><br><span class="line"><span class="number">5.</span>向插入明细表插入n条数据</span><br><span class="line"><span class="number">6.</span>清空购物车数据</span><br><span class="line"><span class="number">7.</span>封装返回结果</span><br></pre></td></tr></table></figure>

<p>订单（orders）和订单详情（order_detail）是什么关系？</p>
<p><strong>“一对多”的主从关系。</strong></p>
<ul>
<li>一个订单对应多条订单详情。</li>
<li>订单详情只隶属于某一个订单，通过 <code>order_id</code> 外键关联。</li>
</ul>
<p>订单详情的数据从何而来？</p>
<p><strong>“复制购物车”而来。</strong></p>
<ul>
<li>用户点击“下单”时，系统先把当前购物车里所有商品记录<strong>逐条复制</strong>成订单详情。</li>
<li>复制时会带上：商品名称、单价、数量、口味、图片等，并回填刚生成的订单号 <code>order_id</code>。</li>
</ul>
<p>订单常见状态有哪些？（由简到繁）</p>
<ol>
<li><strong>待付款</strong></li>
<li><strong>待接单</strong></li>
<li><strong>已接单</strong></li>
<li><strong>派送中</strong></li>
<li><strong>已完成</strong></li>
<li><strong>已取消</strong></li>
</ol>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://jfan-ai.github.io">jfan-ai</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://jfan-ai.github.io/2025/07/14/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96/">https://jfan-ai.github.io/2025/07/14/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://jfan-ai.github.io" target="_blank">jfan-ai</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/java/">java</a></div><div class="post-share"><div class="social-share" data-image="/images/me.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related full-width" href="/2025/07/16/%E9%83%A8%E7%BD%B2%E8%87%AA%E5%B7%B1%E7%9A%84%E5%8D%9A%E5%AE%A2-hexo/" title="部署自己的博客(hexo)"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">部署自己的博客(hexo)</div></div><div class="info-2"><div class="info-item-1">  搭建自己的博客生成自己的.github.io 仓库在本地部署 Hexo 环境 安装 Hexo： npm install -g hexo-cli 初始化 Hexo 框架：hexo init blog 进入上条命令所创建的 blog 文件夹中：cd blog 安装相关依赖：npm install 启动 Hexo 服务：hexo server 访问默认界面，测试是否安装成功：浏览器访问localhost:4000  配置 Butterfly 主题 进入上一步创建的 blog 文件夹中，将 Next 主题相关文件从 github 克隆到 themes 文件夹中 命令：git clone -b master https://github.com/jerryc127/hexo-theme-butterfly.git themes&#x2F;butterfly   配置 Hexo 的主题参数（在根目录的 _config.yml 文件中），选择使用 Next 主题 修改参数为：theme: butterfly   启动 Hexo 服务，验证 Next 主题是否启用 命令行执行：hexo se...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2025/07/23/%E9%BB%91%E9%A9%AC%E7%82%B9%E8%AF%84/" title="黑马点评"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-07-23</div><div class="info-item-2">黑马点评</div></div><div class="info-2"><div class="info-item-1">四方保险学了快一半心累 先搞会儿黑马点评   项目搭建下载和启动Redis 导入数据库 初始化项目  导入项目 配置IDEA环境：检查 JDK、Maven、编码三个方面 加载Maven依赖：直接刷新Maven（建议配置阿里云镜像，网上教程很多） 更改配置：将application.yml文件中的账号密码换成自己的，比如MySQL的账号密码，Redis的地址和密码  1）JDK保障是1.8   2）项目编码保障是UTF-8  3）Maven版本不低于3.4  4）项目路径不要出现中文 启动项目 启动前端项目 解压前端项目，然后进入Dos命令窗口 输入start nginx.exe启动Nginx Nginx是后台启动，我们直接打开浏览器访问http://localhost:8080/，如果看到以下页面则代表前端项目启动成功 启动后端项目 使用IDEA运行后端项目后 打开浏览器访问 http://localhost:8081/shop/1，如果能够看到以下页面就说明后端项目启动成功 注意：首先要保障数据库中的 shop 表中存在 id 为1的这条数据 登录与会话保持基于 Session...</div></div></div></a><a class="pagination-related" href="/2025/07/19/%E5%9B%9B%E6%96%B9%E4%BF%9D%E9%99%A9/" title="四方保险"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-07-19</div><div class="info-item-2">四方保险</div></div><div class="info-2"><div class="info-item-1">不知道能走多远   第0章-环境搭建。。。搞了一上午 无语  （不要开vpn 访问前端 差点放弃） 导入虚拟机设置子网ip 192.168.12.0 设置域名1234C:\Windows\System32\drivers\etc\hosts127.0.0.1 sf.app.itheima.net127.0.0.1 sf.mgt.itheima.net  启动前端管理端访问地址：http://sf.mgt.itheima.net/ 默认账号：admin@qq.com    密码：pass app端访问地址：http://sf.app.itheima.net/#/pages/login/login 账号：15156403088  密码：123456 第1章-项目介绍背景与趋势《四方保险》属于专业互联网保险平台（保险销售平台），是一种在线保险销售平台；提供不同保险公司的保险产品销售、试算、投保和支付等功能。这些平台通常涵盖了整个保险业务流程，从产品购买、保单管理到理赔服务，主要作用是提高用户体验、降低交易成本、加强风险**、可以对比多家保险公司的保险产品管理。**  1234Tips：...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/images/me.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">jfan-ai</div><div class="author-info-description">一个记录技术与生活点滴的个人博客</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">12</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">6</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">4</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/jfan-ai" target="_blank" title="GitHub"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:jfan08559@gmail.com" target="_blank" title="邮箱"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Day-1"><span class="toc-number">1.</span> <span class="toc-text">Day-1</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="toc-number">1.1.</span> <span class="toc-text">开发环境搭建</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#git%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6"><span class="toc-number">1.2.</span> <span class="toc-text">git版本控制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E6%90%AD%E5%BB%BA"><span class="toc-number">1.3.</span> <span class="toc-text">数据库搭建</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%A1%E7%90%86%E5%91%98%E7%99%BB%E5%BD%95%E5%8A%9F%E8%83%BD"><span class="toc-number">1.4.</span> <span class="toc-text">管理员登录功能</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#nginx%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86%E5%92%8C%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1"><span class="toc-number">1.5.</span> <span class="toc-text">nginx反向代理和负载均衡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Swagger"><span class="toc-number">1.6.</span> <span class="toc-text">Swagger</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Day-2"><span class="toc-number">2.</span> <span class="toc-text">Day-2</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B0%E5%A2%9E%E5%91%98%E5%B7%A5%E5%8A%9F%E8%83%BD"><span class="toc-number">2.1.</span> <span class="toc-text">新增员工功能</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%91%98%E5%B7%A5%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2"><span class="toc-number">2.2.</span> <span class="toc-text">员工分页查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%AF%E7%94%A8%E7%A6%81%E7%94%A8%E8%B4%A6%E5%8F%B7%E5%8A%9F%E8%83%BD"><span class="toc-number">2.3.</span> <span class="toc-text">启用禁用账号功能</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%96%E8%BE%91%E5%91%98%E5%B7%A5%E4%BF%A1%E6%81%AFand%E6%A0%B9%E6%8D%AEid%E6%9F%A5%E8%AF%A2%E5%91%98%E5%B7%A5%E4%BF%A1%E6%81%AF"><span class="toc-number">2.4.</span> <span class="toc-text">编辑员工信息and根据id查询员工信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%91%98%E5%B7%A5%E4%BF%AE%E6%94%B9%E5%AF%86%E7%A0%81%E5%8A%9F%E8%83%BD"><span class="toc-number">2.5.</span> <span class="toc-text">员工修改密码功能</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%BC%E5%85%A5%E5%88%86%E7%B1%BB%E6%A8%A1%E5%9D%97%E5%8A%9F%E8%83%BD%E4%BB%A3%E7%A0%81"><span class="toc-number">2.6.</span> <span class="toc-text">导入分类模块功能代码</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Day-3"><span class="toc-number">3.</span> <span class="toc-text">Day-3</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%AC%E5%85%B1%E5%AD%97%E6%AE%B5%E8%87%AA%E5%8A%A8%E5%A1%AB%E5%85%85"><span class="toc-number">3.1.</span> <span class="toc-text">公共字段自动填充</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%AE%9E%E7%8E%B0"><span class="toc-number">3.2.</span> <span class="toc-text">文件上传实现</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B0%E5%A2%9E%E8%8F%9C%E5%93%81"><span class="toc-number">3.3.</span> <span class="toc-text">新增菜品</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8F%9C%E5%93%81%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2"><span class="toc-number">3.4.</span> <span class="toc-text">菜品分页查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%B9%E6%8D%AEid%E6%9F%A5%E8%AF%A2%E8%8F%9C%E5%93%81"><span class="toc-number">3.5.</span> <span class="toc-text">根据id查询菜品</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E8%8F%9C%E5%93%81"><span class="toc-number">3.6.</span> <span class="toc-text">修改菜品</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Day-4"><span class="toc-number">4.</span> <span class="toc-text">Day-4</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A5%97%E9%A4%90%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97%E6%89%80%E6%9C%89%E4%B8%9A%E5%8A%A1%E5%8A%9F%E8%83%BD"><span class="toc-number">4.1.</span> <span class="toc-text">套餐管理模块所有业务功能</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Day-5"><span class="toc-number">5.</span> <span class="toc-text">Day-5</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Redis%E5%85%A5%E9%97%A8"><span class="toc-number">5.1.</span> <span class="toc-text">Redis入门</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Redis%E6%A6%82%E8%BF%B0"><span class="toc-number">5.1.1.</span> <span class="toc-text">Redis概述</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Redis%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-number">5.1.2.</span> <span class="toc-text">Redis数据类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%A8Java%E4%B8%AD%E6%93%8D%E4%BD%9CRedis"><span class="toc-number">5.1.3.</span> <span class="toc-text">在Java中操作Redis</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%97%E9%93%BA%E8%90%A5%E4%B8%9A%E7%8A%B6%E6%80%81%E8%AE%BE%E7%BD%AE"><span class="toc-number">5.2.</span> <span class="toc-text">店铺营业状态设置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Swagger%E6%8E%A5%E5%8F%A3%E5%88%86%E7%BB%84"><span class="toc-number">5.3.</span> <span class="toc-text">Swagger接口分组</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Day-6"><span class="toc-number">6.</span> <span class="toc-text">Day-6</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#HttpClient"><span class="toc-number">6.1.</span> <span class="toc-text">HttpClient</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%BC%80%E5%8F%91"><span class="toc-number">6.2.</span> <span class="toc-text">微信小程序开发</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BE%AE%E4%BF%A1%E7%99%BB%E5%BD%95%E6%B5%81%E7%A8%8B"><span class="toc-number">6.3.</span> <span class="toc-text">微信登录流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#OpenID-%E4%B8%8E%E6%8E%88%E6%9D%83%E7%A0%81%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-number">6.4.</span> <span class="toc-text">OpenID 与授权码的区别</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BE%AE%E4%BF%A1%E7%99%BB%E9%99%86%E9%9B%86%E6%88%90"><span class="toc-number">6.5.</span> <span class="toc-text">微信登陆集成</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8F%9C%E5%93%81%E6%B5%8F%E8%A7%88%E5%8A%9F%E8%83%BD"><span class="toc-number">6.6.</span> <span class="toc-text">菜品浏览功能</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Day-7"><span class="toc-number">7.</span> <span class="toc-text">Day-7</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%93%E5%AD%98%E8%8F%9C%E5%93%81"><span class="toc-number">7.1.</span> <span class="toc-text">缓存菜品</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E4%BD%BF%E7%94%A8Redis%E5%81%9A%E7%BC%93%E5%AD%98"><span class="toc-number">7.2.</span> <span class="toc-text">为什么要使用Redis做缓存</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%8E%E4%B9%88%E4%BF%9D%E9%9A%9C%E6%95%B0%E6%8D%AE%E4%B8%80%E8%87%B4%E6%80%A7"><span class="toc-number">7.3.</span> <span class="toc-text">怎么保障数据一致性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%A8%E4%BA%86-Redis-%E5%B0%B1%E4%B8%80%E5%AE%9A%E8%83%BD%E9%AB%98%E5%B9%B6%E5%8F%91%E5%90%97%EF%BC%9F"><span class="toc-number">7.4.</span> <span class="toc-text">用了 Redis 就一定能高并发吗？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Spring-Cache"><span class="toc-number">7.5.</span> <span class="toc-text">Spring Cache</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E6%B3%A8%E8%A7%A3"><span class="toc-number">7.5.1.</span> <span class="toc-text">常用注解</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%A5%E9%97%A8"><span class="toc-number">7.5.2.</span> <span class="toc-text">入门</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A5%97%E9%A4%90%E7%BC%93%E5%AD%98"><span class="toc-number">7.6.</span> <span class="toc-text">套餐缓存</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E8%B4%AD%E7%89%A9%E8%BD%A6"><span class="toc-number">7.7.</span> <span class="toc-text">添加购物车</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B6%E4%BD%99%E8%B4%AD%E7%89%A9%E8%BD%A6%E5%8A%9F%E8%83%BD"><span class="toc-number">7.8.</span> <span class="toc-text">其余购物车功能</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DAY-8"><span class="toc-number">8.</span> <span class="toc-text">DAY-8</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%BC%E5%85%A5%E5%9C%B0%E5%9D%80%E7%B0%BF%E5%8A%9F%E8%83%BD"><span class="toc-number">8.1.</span> <span class="toc-text">导入地址簿功能</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E4%B8%8B%E5%8D%95"><span class="toc-number">8.2.</span> <span class="toc-text">用户下单</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/07/23/%E9%BB%91%E9%A9%AC%E7%82%B9%E8%AF%84/" title="黑马点评">黑马点评</a><time datetime="2025-07-23T07:28:40.415Z" title="发表于 2025-07-23 15:28:40">2025-07-23</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/07/22/%E4%B8%89%E5%A4%A7%E6%A0%B8%E5%BF%83%E8%AE%A1%E7%AE%97-%E6%B1%82%E5%AF%BC/" title="三大核心计算-求导数">三大核心计算-求导数</a><time datetime="2025-07-22T13:00:00.000Z" title="发表于 2025-07-22 21:00:00">2025-07-22</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/07/20/%E4%B8%89%E5%A4%A7%E6%A0%B8%E5%BF%83%E8%AE%A1%E7%AE%97-%E4%B8%8D%E5%AE%9A%E7%A7%AF%E5%88%86/" title="三大核心计算-不定积分">三大核心计算-不定积分</a><time datetime="2025-07-20T13:00:00.000Z" title="发表于 2025-07-20 21:00:00">2025-07-20</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/07/19/%E4%B8%89%E5%A4%A7%E6%A0%B8%E5%BF%83%E8%AE%A1%E7%AE%97-%E6%B1%82%E6%9E%81%E9%99%90/" title="三大核心计算-求极限">三大核心计算-求极限</a><time datetime="2025-07-19T13:00:00.000Z" title="发表于 2025-07-19 21:00:00">2025-07-19</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/07/19/%E9%AB%98%E6%95%B0%E5%9F%BA%E7%A1%801/" title="高数基础1">高数基础1</a><time datetime="2025-07-19T13:00:00.000Z" title="发表于 2025-07-19 21:00:00">2025-07-19</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url(/images/top.jpg);"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;2025 By jfan-ai</span></div><div class="footer_custom_text"><p>生于忧患，死于安乐。</p>
</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"></div><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>(() => {
  const pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

  window.pjax = new Pjax({
    elements: 'a:not([target="_blank"]):not([href="/music/"]):not([href="/no-pjax/"])',
    selectors: pjaxSelectors,
    cacheBust: false,
    analytics: false,
    scrollRestoration: false
  })

  const triggerPjaxFn = (val) => {
    if (!val) return
    Object.values(val).forEach(fn => fn())
  }

  document.addEventListener('pjax:send', () => {
    // removeEventListener
    btf.removeGlobalFnEvent('pjaxSendOnce')
    btf.removeGlobalFnEvent('themeChange')

    // reset readmode
    const $bodyClassList = document.body.classList
    if ($bodyClassList.contains('read-mode')) $bodyClassList.remove('read-mode')

    triggerPjaxFn(window.globalFn.pjaxSend)
  })

  document.addEventListener('pjax:complete', () => {
    btf.removeGlobalFnEvent('pjaxCompleteOnce')
    document.querySelectorAll('script[data-pjax]').forEach(item => {
      const newScript = document.createElement('script')
      const content = item.text || item.textContent || item.innerHTML || ""
      Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
      newScript.appendChild(document.createTextNode(content))
      item.parentNode.replaceChild(newScript, item)
    })

    triggerPjaxFn(window.globalFn.pjaxComplete)
  })

  document.addEventListener('pjax:error', e => {
    if (e.request.status === 404) {
      const usePjax = true
      false
        ? (usePjax ? pjax.loadUrl('/404') : window.location.href = '/404')
        : window.location.href = e.request.responseURL
    }
  })
})()</script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>